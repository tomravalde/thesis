# Case study: a Chinese urban development

[TODO: Add note on published aspects of this work (e.g. conference paper)?]

```{r Setup, include=FALSE, results="hide", warning=FALSE}
library(knitr)
opts_chunk$set(fig.path = "figures/", dev=c("cairo_pdf"), fig.pos='htbp', fig.width=5, fig.height=3.5, dpi=700, fig.show='hold', fig.lp="fig:", cache=FALSE, par=TRUE, echo=FALSE, results="hide", message=FALSE, warning=FALSE)

library(extrafont)
font_import(pattern="LinBiolinum")

library(ggplot2)
```
<!--
Sections in JK's MILP paper

# Case study

- proposed eco-town development (ambitions)
- site characteristics
- zonal demands
- timings
- figrues with data

## Resources and technologies
## Objective function
## Results
-->

This thesis has argued for the need for an optimisation model which can help plan urban energy, water and waste infrastructure, in combination, with a view to improving the urban metabolism of an area. To that end, the previous chapter introduced the PRaQ model -- a MILP formulation that is generic enough to incorporate multiple resource types, user-friendly to construct, and can be solved without excessive computational effort. The computational implementation of the model is structured to separate code and data, for further ease of use. This chapter now applies this model to a case study, using the library of resource management processes assembled in Chapter 4, and using the metrics of Chapter 3 to assess the systems designed by the model.

The case study is an ongoing Chinese urban development. The development is led by the Xi'an Shann Gu Power Company (SPC), who historically have provided turbo-machinary services (such as steam turbines, fans and energy recovery units) for the chemical industry, power generation, construction, and other sectors requiring heavy machinery [TODO: cite http://www.shaangu.com/ENGLISH/About.jsp?urltype=tree.TreeTempUrl&wbtreeid=1071]. The SPC are currently implementing plans to redevelop one of their industrial sites and the surrounding region. The wider site is in the Xi'an province of China with an area of 51.03 km$^2$, which includes a short-term construction region of 13 km$^2$ which can accommodates 133,000 people. This short-term construction area has residential, commercial, industrial and recreational functions, roughly represented by Figure \ref{fig:site} [^confidential]. The homes, businesses and industrial functions will all have needs to manage energy, water and waste. Another specific need of interest is in the recreational area, which includes an artifical lake, which the planners hope to source via a water reuse project [SCP-water].

[^confidential]:The documentation regarding the SPC redevelopment plans is confidential and thus certain information (such as the precise site location) cannot be given here. There are six SPC documents (reports and PowerPoint presentations) from which this chapter draws information. In this thesis, these will be cited as 'SCP [X]', where X refers to one of the six papers, namely: 'energy' (details on energy needs and provision), 'water' (details on water needs and provision), 'sewage' (details on wastewater management needs and provision), 'intro' (general details about the SPC site redevelopment), 'site' (specific details about the site), 'demand' (demand data).

\begin{figure}
	\centering
	\begin{spacing}{1.0}
	\sffamily
	\resizebox{0.5\columnwidth}{!}{\input{06_case-study/site.pdf_tex}}
	\end{spacing}
	\caption{A stylized representation of the SCP redevelopment site, adapted from a figure in the SCP documentation. The outer dashed rectangle encloses the full 13 km$^2$ site; the solid rectangles and their bold text labels represent broad regions within the site (e.g. region nine is \textbf{residential}; the unbolded text labels denote zones more specifically (e.g. a hospital within the residential region).}
	\label{fig:site}
\end{figure}

One stated ambition of the SCP site redevelopment is to integrate the energy, water and waste management services in order to maximise energy efficiency, minimise the discharge of waste, and minimise economic costs. Current plans to that end include using heat held within wastewater within a water source sewage pump, and generating biogas from wastewater fermentation. These, and other intersectoral integration possibilities [TODO: better word?] are summarised in Figure [TODO:], which shows part of the resource management infrastructure proposed for the SPC site, indicating the type of intersectoral integration considered by the planners and decision makers involved with the SPC site redevelopment project.

[TODO: adapt Figure below, to show all connections.]

\begin{figure}
	\centering
	\begin{spacing}{1.0}
	\sffamily
	\resizebox{0.5\columnwidth}{!}{\input{06_case-study/site-dimensions.pdf_tex}}
	\end{spacing}
	\caption{A re-representation of the SCP redevelopment site, indicating connections defined for set $nb(z,z')$. All distances are in kilometers. Each region centre connects to the other zones in the region (e.g. \textbf{Factory (south)} $\leftrightarrow$ Assembly) with a connection assumed to be 0.5 km in length.}
	\label{fig:site-connectionss}
\end{figure}

Some proposed system design have been simulated (for example using the TRNSYS[^trnsys] to simulate the energy, system), however this does not include detailed consideration of the water and waste systems. Furthermore, the system design has not been subjected to optimisation modelling. Thus, this case study presents an opportunity to (i) model water and waste systems, alongside the energy system; (ii) to go beyond simulations by applying optimisation modelling; and (iii) to consider not just the current proposed system designs, but also those made possible when the database of Chapter 4 is considered.

[^trnsys]: \url{http://sel.me.wisc.edu/trnsys/index.html}. This program allows users to lay out the components of an energy system (drawn from a library of thermal and electrical energy components), linking them together in a modular fashion, in order to simulate the behaviour of an overall energy system.

This chapter proceeds by adapting the information from SCP documentation, to construct the model (for example identifying zones, interzonal links, and resource demands). Following this, Section [TODO: subsection number] introduces several scenarios which the model can test. These scenarios will all use the same demand patterns specified in the SPC documentation, but use different objectives, and have different sets of processes available. This will allow investigation of both currently proposed system designs, as well as others. Finally, this model will present and discuss the modelling results, and thus provide insight to planners and decision makers developing SCP site plans further.

<!--
- [SCP-4, slide 17: water, waste and energy jigsawed together]
- [SCP-4, slide 19: Energy island with CHP, CCHP and sewage source heatpump 
- [SCP-4, slide 21: Energy island]
- [SCP-4, slide 22: Energy provision via CHP, CCHP and sewage source heatpump, (as well as traditional and renewable approaches)]
- [SCP-4, slide 25: "Increase energy supply efficiency", "decrease discharge cost" and influence "by cycle reuse", in order to save energy, give social benefits, and economic efficiency]
- [SCP-4, slide 26: Energy island logic diagram, incorporating sewage treatment, water reuse, solid waste treatment, cooling/heating, and solar-PV power]
- [SCP-4, slide 27: Within that, the "Combined water supply and treatment system" has WSHP, rainwater collection, fermentation to produce biogas, sewage plant, water treatment, and water reclamation]
-->

## Model data
<!--
- Data
  	- resources
  		- generic
  		- specific, due to the site, e.g. exergy of heat
  	- processes
  		- generic, from the database
	  	- specfic, due to the site, e.g. rain, leachate = f(rain, evaporation, landfill area)
		- real processes, heat exchangers (and associated water flows)
		- dummy processes (e.g. MSW splitting, waste generalising)
-->

When applying the model to a case study, the first step is to specify the zones and time steps [TODO: better word? slices?] used in the model, which are indexed by $z$ and $t$, respectively. With the zones determined, another a set specifies whether any pair of zones $(z,z')$ are neighbours, defined as any pair of zones which exist in the $nb(z,z')$ set. Following this, the sets of processes and resources available to the model can be specified, indexed by set $p$ and $r$, respectively. Once the resources have been specified, there is enough information to define the two final sets: first, quality attributes which should be defined (specified by a set indexed by $q$); and second, the transport technologies which can transport the resources between zones (indexed by $\tau$).

With the sets specified, their related parameters can be defined. First the distance between between two any two neighbouring zones defines the $l_{zz'}$ parameter (km), while the $span_t$ parameter defines the length of time (days) of each time step lasts. The resource demands can then be specified for each time and location with the $D^{(qty}_{rzt})$ parameter. (As mentioned in Chapter 5, the model code is built so that it will automatically define the $D^{(qual)}_{qzt}$ parameter.) Other parameters will include the limits on imports and exporting resources to particular zones, and the costs of resources and processes [TODO: TBC].

This section gives the key particulars on how the sets and parameters above are defined from the SPC documentation, with further details provided in Appendix [TODO: cross-ref]. The explanations are deliberately comprehensive, reflecting on why certain decisions and assumptions regarding data are made, with the intention of justifying modelling decisions taken here, as well as walking the reader through how one might design a model for a particular case study, and when it would be appropriate to take different decisions. The details are given in the recommended order of how a user might construct a particular case study model, and thus each subsection describes how different components of the formulation (e.g. sets and parameters) relate to each other [TODO: tidy this last part of explanation].

```{r resource-demands, fig.height=5, fig.cap="Resource management demands for the SCP site, according to zone and season. Negative values for (i.e., for wastes and wastewaters) indicate the production of a resource.\\label{fig:site-demands}"}
demands <- read.csv("06_case-study/resource-demands.csv")

#library("dplyr")
#filter(demands, value.conv!=0)

plot_demand <- ggplot(demands, aes(zone, value.conv)) +
  geom_dotplot(aes(fill=season), binaxis="y", position=position_dodge(width=0.6)) +
  facet_wrap(~resource) +
  xlab("Zone") +
  labs(fill="Season") +
  theme_bw() +
  theme(axis.text.x = element_text(hjust=1, angle=30),
	axis.title.y = element_blank())
plot_demand

```

[TODO: adapt Appendix from supplementary information (shann-gu-case-study/paper/supInf.Rmd)]

### Site layout

Each of the twelve zones shown in Figure \ref{fig:site} (both the three larger regions, and the nine functions they encompass) will be modelled in this case study, and thus each are encoded in the model as zones $z \in Z$, where $Z=12$. The parameter which defines site layout is $l_{zz'}$, which specifies the distance between any $z,z'$ pairs belonging to set $nb(z,z')$. All this information for the SPC case study is shown on Figure [TODO:], in which the zones and regions from Figure \ref{fig:site} have been translated into the zones for the model. Note then that in this model, to be a 'neighbour' is not primarily a function of geographical proximity, rather it is one of 'connectedness'.

[TODO: insert a figure which is a zonal representation of the site, marked with interzonal distances.]

Thus to define the site layout, we first assume which pairings belong to set $nb(z,z')$, and then estimate the lengths of these connections. For the SPC site, we will assume that roads are assumed to exist along any connection. Additionally, these connections can optionally include underground pipes and overhead cables, running along the length of the road[^road-cost].

[^road-cost]: As discussed in Section [TODO:], this means that roads have no financial cost in the model, whereas pipes and cables will.

We will assume that the three broader regions will be linked via a connection running north-south through the site. Then we assume that the functions within a particular region are equidistant from the region's centre (with the exception of the energy island which does not belong to a region). This makes the size of set $nb(z,z')$ as $NB=12$. With the connections determined, the distances are estimated, based on the site's dimensions. We assume that the region-to-region connections join the regional centroids, thus distances can be measured by scaling distances from the site plans in the SCP documentation. The region-to-function distances will be assumed as [TODO: 0.5] km. In total, there are twelve two-way connections defined, which are given in Table \ref{tab:zonal-connections}.

[TODO: insert a photo of me with a ruler, doing the measurements!]

\begin{table}[]
\centering
\caption{The zonal connections defined for set $nb(z,z')$, and their corresponding lengths $l(z,z')$ used in the SPC case study.}
\label{tab:zonal-connections}

\begin{tabular}{@{}llll@{}}
\toprule
$z$                      & $z'$                     & Dimension on plan {[}cm{]} & Site dimension {[}km{]} \\ \midrule
\textbf{Factory (south)} & \textbf{Factory (north)} & 3.4                        & 0.9                     \\
\textbf{Factory (south)} & Assembly                 & NA                         & 0.5                     \\
\textbf{Factory (south)} & Multifunction district   & NA                         & 0.5                     \\
\textbf{Factory (south)} & Dormitories              & NA                         & 0.5                     \\
\textbf{Factory (south)} & Turbines                 & NA                         & 0.5                     \\
\textbf{Factory (north)} & Technology building      & NA                         & 0.5                     \\
\textbf{Factory (north)} & Quality control          & NA                         & 0.5                     \\
\textbf{Factory (north)} & Energy island            & $4.8+1.3=6.1$              & $1.3+0.4=1.7$           \\
\textbf{Factory (north)} & \textbf{Residential}     & $4.8+3.4=8.2$              & 2.2                     \\
\textbf{Residential}     & School                   & NA                         & 0.5                     \\
\textbf{Residential}     & Hospital                 & NA                         & 0.5                     \\
\textbf{Residential}     & Reserved                 & Assume                     & 1                       \\ \bottomrule
\end{tabular}
\end{table}

The GAMS code for this data is listed in Appendix [TODO:]. 

<!--
Assembly,Factory (south)
Factory (north),Factory
Multifunction district,Factory (north)
Technology building,Factory (north)
Dormitories,Factory (north)
Energy island,Multifunction district
Technology building,Turbines
Quality,factory_blades
school,Residential
school,hospital
school,energyIsland
school,reserved
-->

### Times

The SPC [demand] provides values of energy demands for winter, summer and year round. This model therefore uses three timesteps, specified by $t \in T$, where $T=3$, representing the winter, summer, and shoulder seasons. This means that the infrastructure selected by the model would be in place all year round, but could operate differently in each season. Consider the provision of domestic heating provided by district heating as an example: in the winter, the district heating would be delivering heat to homes, and this would have an impact on the operation of heat-generating processes upstream. However, these upstream impacts would not occur in the summer, when district heating does not run. As this phenomenon is applied in relation to other resource demands, the chain of processes emerging from the system interactions could operate differently according to season, in order to optimise the site's metabolism.

Of course, operation might not just vary by season, but could vary for smaller time slices. For example each season could have alternative weekday and weekend resource demand (thus $T=3 \times 2 = 6$), which could further be divided into hourly demands (thus $T=3 \times 2 \times 24 = 144$). The temporal resolution could become finer still, using minute-by-minute and second-by-second demand patterns. However, the choice of seasonal timesteps has at least three reasons. The pragmatic reason, is that this is how the SPC documentation defines the energy demands. The philosophical [TODO: better word? modelling judgement] reason is that seasonal time slices are appropriate to the exploratory early-stage planning purposes of this model [TODO: cite examples of similar models, e.g. MARKAL etc.] . Finer resolution would be appropriate the further along the design process the modelling is. However, modelling judgement is also the reason why it is inappropriate to aggregate the demand up to a coarser scale (i.e. a year). In such a case, a yearly averaged value of head (to take one example) would overdesign the summer system operation, while undersizing the winter system operation, potentially resulting in a suboptimal system design [TODO: clarify this]. Finally, there is a computational reason. As shown in Chapter 4, if $T$ doubles, the number of variables increases by [TODO:], leading to an estimated [TODO: X-fold] increase in computation time. [TODO: note on heirarchical time discretisation, for a more tractable approach, to be explored in future.] These latter two points interact, as the further along the planning process (from explanation to detailed design), it is justifiable to expend more effort (including computational resources), thus a finer temporal resolution may be warranted. Further more, at the more detailed design stages, some decisions will have been made (the location of a particular conversion process, whilst its size remains unknown, for example), thus reducing the number of variables in the model, and thereby making some efficiency savings to the computations.

With this set of times chosen, the length of each timestep is defined as parameter $span(T)$ with the winter, summer, and shoulder seasons having spans of 90 days, 90 days, and 180 days respectively.

### Resource demands

Having determined the seasons and the time steps in the model, it is now possible to define the resource demand parameter $D^{(qty)}_{rzt}$ for each resource $r$. (As mentioned in Chapter 4, the code which constructs a model is designed such that $D^{(qual)}_{rqzt}$ can be defined automatically once $D^{(qty)}_{rzt}$ is known.) The SPC documentation will provides values which can be used in the modelling. However, these values do not necessarily cover all resources $r$, and may not be disaggregated to each zone $z$ and season $t$. Thus, sometimes, assumptions and calculations need to be applied in order to translate a documented value into a set of values which can be used in the modelling. The details of these adjustments are provided in Appendix [TODO:].

The resource demands used in the SPC model are summarised in Figure \ref{fig:site-demands}, showing the seasonal demand for energy (electricity, heating, and cooling), water (potable, and reclaimed), and waste management (wastewater, nonorganic solid waste, and organic solid waste). The precise numeric values used in the model are provided in Appendix [TODO:]. 

Resource demands are defined as rates, i.e. on a per-second basis (kg/s or MW). This is a common way to express energy quantities, which makes sense given that energy is most commonly demanded on such a basis[^energy-rate]. This makes resource quantities in the model consistent with how the model defines process behaviour, where the process rate is defined on a per-second basis, and thus no adjustment multipliers need to be added into the equations. Thus by using rates, whatever the temporal resolution of a model (see the options discussed in Section [TODO:], above), the formulation need not substantially change[^rates-objective].

[^energy-rate]: This is in contrast to waste management services (to give one example) in which waste may be collected at regular intervals (e.g. weekly), and set to a particular processing unit once a certain threshold (e.g. tons) has been met. Nevertheless, for usability, there should be consistency between the definition of energy and mass quantities. One way to capture the non-rate properties of many material-based processes (and indeed, some energy-based processes, such as [TODO:]) would be to introduce storage processes into the model. This may be the subject of future developments, as discussed in Section [TODO:]. 

[^rates-objective]: The objective function formulation may need to consider the temporal resolution of the model. For example, if the objective function calculates system costs over a year, then an appropriate multiplication factor will need to be applied to each time period. This can by achieved with the appropriate definitions of the $span(t)$ parameter.

### Other resources

The resource demands discussed above will define some of the $r$ items in set $R$, but to complete this set requires the resources which used in the network of conversion processes to meet demand. In total, there are [TODO: 63?] resources, including everything from algae to wood.

Each resources has at least one associated quality $q$ (belonging to set $Q$), and attributed to the resource using the $X_{rq}$ and $\delta^R_{rq}$ parameters. The qualities used in this case study are *mass* and *energy*. Most resources are only attributed with one of these (e.g. algae possesses mass, and heat possesses energy), though some resources are attributed with both mass and energy (e.g. ground water). The full list of resources and their associated qualities can be found in Appendix [TODO:].

Costs are also associated with resources for use in the objective function. These are based on [TODO:], and are given in Table [TODO:]. 

With the resources, zones and times determined (indixed by $r$, $z$, $t$, respectively), the parameters which impose limits on how many zones can import and export particular resources ($N^I_r$, $N^E_r$), and the maximum allowable imports of a resource in a season ($I^{max}_{rt}$, $E^{max}_{rt}$) can be specified. These values are shown in Table [TODO:], below. 

[TODO: insert table of resource/zone import constraints. Many are the same, so only need to include the exceptions.]

### Conversion processes

The resource conversion processes used in the model will be taken from the open-source database of urban metabolism processes outlined in @Ravalde2015b[^process-data], or the Shann Gu documentation. Each process definition also includes its capacity (i.e. the maximum MJ/s or kg/s which can be converted). This database provides the values to define process behaviour data (namely the coefficients which define the input and output resource quantities with $k_{pr}$, and maximum process rates $F^{max}_p$). The size of the process set $P$ will vary for each scenario (with are detailed in Section [TODO:] below).

In addition to these parameters, each process needs to have a cost for use in the objective function [TODO:]. We attempt to estimate process costs here, but note the difficulties in doing this. Aside from the shear number of processes in the database ([TODO: N] in total), several factors make this tricky. First and foremost, the process database includes future processes which have not yet penetrated into the market, thus there is no values to be used. Secondly, currency exchange rates and purchasing power parities around the world make it difficult to attribute a cost to a process with any degree of certainty. For this reason, our costing is approximate.

The broad approach to estimating process costs is to assemble a database of 'process types' ($PT$), with each $PT$ forming [TODO: better word] a category to which processes from the database -- 'database processes' ($DP$) -- are assigned. As an example, *'biogas-fuelled CHP'* is defined as a $PT$, which includes [TODO: find data, and list examples]. For each $PT$, unit costs (USD/MW or USD/kg/s) is obtained from the literature (this may require some assumptions and adjustments to numbers from the literature, of which details are given in Appendix [TODO:]). One guiding principle of the process cost estimation are that economies of scale should be applied[^scale-economy]. For this to be captured in the model, each $PT$ has both lowerbound and upperbound unit costs, obtained from the literature (and adjusted according to necessary assumptions). Thus, the total cost (USD) of any particular $DP$ with a given capacity (MW or kgs/s) can be calculated from:

[^scale-economy]: For example, if a system demand requires 10 MW, then it should be cheaper to meet that demand with two 5 MW plants than 10 1 MW plants, of the same type.

$$
\begin{align}
\mbox{DP Total Cost} = \mbox{PT Unit Cost}^* \times \mbox{DP capacity},
\end{align}
$$

where $^*$ is wildcard notion to indicate either a lowerbound or an upperbound cost ($Cost^{LB}$ and $Cost^{UB}$, respectively). In this way, lowerbound costs are applied to larger instances of a process, and the latter applied to a smaller instance.

This method estimates costs for conversion processes which do not yet exist in the market by For processes which do not yet exist by assigning these $DP$s [TODO: e.g. <example>], to a $PC$ which has a similar main resource in its conversion (either as a main input output)[^main]. This method is broadly conservative in its approach, on the assumption that new processes will not penetrate the market unless they deliver a particular service at lower cost than a more traditional means of conversion[^cost-estimation].

[^main]: Recall from Chapter [TODO: chapter and section reference] the idea of a 'main' resource being the (e.g. electricity output for a powerplant, or wastewater input to a treatment facility), and always has a value of $k_{pr}=\pm 1$.

[^cost-estimation]: Though this may be countered by the fact that a novel process may be more expensive than older methods due to other benefits (e.g environmental benefits). However, this thesis can only hope to be approximate with the cost of conversion processes, and indeed, such estimations warrant their own separate research focus [TODO: https://www.rand.org/content/dam/rand/pubs/reports/2006/R2481.pdf, https://core.ac.uk/download/files/23/140606.pdf].

In summary, the database assembled in Chapter [TODO:] will provide the conversion processes which can be considered in the SPC case study (using various subsets according to different modelling scenarios, as outlined in Section [TODO:] below, defining model parameters $k_{prq}$ and $F^{max}_p$. Added to these processes have been estimated costs (defining model parameters $c^P_p$), which enable to model to take account of economies of scale, and the cost of processes which do not yet exist. The result is that the SPC modelling has up to [TODO:] conversion processes from which to design an integrated resource management system, for which a rough cost can be obtained. 

### Transport processes

The selection of transport processes to define set [TODO: design a symbol which isn't T for this]  for the SPC case study are based on the resources being considered, many of which can be transported between zones via various infrastructure (with some exceptions such as heat[^heat-transport]). To transport these resources, there are three types of transport infrastucuture: roads, alongwhich vehicles can transport everything from municipal solid waste, to gases and liquids carried by tankers; pipes, which transport water and gases; and cables, to carry electricity. As explained in the Section [TODO:], the roads are assumed to already exist to connect neighbouring zones ($nb(z,z')$), whilst underground pipes and overhead cables can be optionally added by the optimisation model, if and where necessary.

[^heat-transport]: Though whilst heat itself cannot be transported, it can be carried by water, e.g. in a district heating network.

Regarding the behaviour of transport processes, the origin-to-destination input and output coefficients, $k^*_{\tau rq}$ should obviously include the resource carried (e.g. water through a pipe). In addition to this, transport processes may need 'auxilliary' resources, namely the source of the energy used to carry that resource along the length of a connection (e.g. electrical energy to pump water along a pipe), as well as any by-products, wastes, and emissions from the process. While it is taken for granted that the carried resource entirely leaves to origin zone, and arrives in the destination zone (perhaps less some losses, such as electrical losses along a cable), it needs to be determined how wastes, by-products and emissions are shared between zones. The details on transport process behaviour for the three main types of technologies considerations are now described, with specific values of $k^*_{\tau rq}$ given in Table \ref{tab:transp-coeffs}. 

\begin{description}

\item[Cable] This is the simplest transport process type since the resource carried, and the resource which provides the carrying energy are one and the same, namely electricity, thus only a single $r$ value is necessary here. Electrical cables do incurr losses of between 3--7\% over 1,000 km distances [TODO: cite \url{http://iea-etsap.org/web/Highlights%20PDF/E12_el-t&d_KV_Apr2014_GSOK%201.pdf}], however, given the interzonal distances for the SPC site are all under [TODO: N] km, losses are considered negligable. Thus cables can be defined simply with $k^{\alpha}_{\tau rq}=1$, $k^{\alpha'}_{\tau rq}=-1$, and $k^{\beta}_{\tau rq}=0$, when $\tau=\mbox{cable}$ and $r=\mbox{elec.}$ [TODO: tidy].

\item[pipes] These carry a resource (e.g. $r=\mbox{water}$) as well as pumping energy. As hydraulic calculations given in Appendix [TODO:] show, for water in a pipe of no slope, this can be roughly calculated as approximately $0.0054l_{zz'}$ to overcome friction between the water and the pipe, on the assumption that the volume flowrate is around $1 m^3/s$\footnote{At this value, the nonlinearities in the relationship between transport mass and volume can be ignored [TODO: better phrasing?]}. It is assumed that all this electricity is provided in the zone of the water's origin, thus [TODO: summarise $k$ values] . For gases it is assumed that friction is lower enough so as to make the energy requirements negligable for the distances in the SPC site.

\item[vehicles] Other resources are carried by vehicles along the road network. As well as the carried resource (e.g. $r=\mbox{biomass}$. The source of carrier energy is $r=\mbox{gasoline}$, which is provided entirely by the source zone. As well as this, \CO2 emissions are emitted, with these being shared equally between the origin and destination zones. Calculations in Appendix [TODO:] derive $k$ values as [TODO: complete].

\end{description}

\input{06_case-study/tab-transp-coeffs.tex}

For process rates, $F^{transp}_{\tau zzt}$, [TODO: complete] 

As with the conversion processes, transport processes each need to have an associated cost, $c^T_{\tau}$. As the roads already exist, these are not costed in our model, as they would have the same cost, whatever the system designed by the model. The cost for the pipes and roads are defined per kilometer, and the values and sources for these calculations are provided in Appendix [TODO:] .

[TODO: clarify if it's possible for the model to charge per vehicle, for the road transport infrastructure]

### Summary

This section has provided the data used to define the model's parameters while showing how various parts of the model relate to each other, and in doing-so has provided a guide on how one might construct the PRaQ model for a particular case study. 

Now, this chapter turns to outline the [TODO: N] scenarios that our model will test. 

## Model scenarios

We study [TODO: number] scenarios using different subsets of the processes, to suggest how different networks of processes can satisfy demand under varying circumstances (following the methodology of @Keirstead2012). For some scenarios, we model sub-scenarios, where we use different objective functions, or introduce an additional constraint to illustrate Pareto optimality. The scenarios are:

1. *Base case.* This assumes that electricity, fuels and water are imported to the site as needed (with wastewater treated on site), thus there is no attempt to take advantage of synergies. As such, this scenario provides baseline results.
2. *Design case.* The Shann Gu site developers intend to take advantage of intersectoral synergies to minimise resource consumption. This scenario considers the processes suggested in the Shann Gu documentation, including combined heat and power (CHP), a wastewater source heatpump combined with a district heating network. We consider how the process choice changes, with different objecitves:
	a. Minimise cost
	b. Minimise emissions
	c. Minimise waste
	d. Minimise freshwater consumption
3. *Wildcard case.* This scenario allows any process from the database compiled by @Ravalde2016 to be incorporated into the site's resource management network. This database includes both existing and still-to-be-implemented management processes, so we consider the following sub-scenarios, at minimum cost:
   	a. Currently available processes
   	b. Medium-term available technologies
   	c. Long-term available technologies

Scenario 3a [TODO: update if necessary] is the largest, and thus indicates the computational effort required to solve the problems, having [TODO: number] single variables, [TODO: number] discrete variables, [TODO: number] binary variables, [TODO: number] equations [TODO: etc.].

These scenarios are fairly simple, and illustrate the sensitivity of a network to fairly broad considerations (technology availability, and simple objective functions). Detailed design problems should be more narrowly focussed, by applying sensitivity analysis to understand how a system design responds to changes in efficiency (reducing demand), market value of imported and exported goods, and other factors. [TODO: reproduce Saltelli et al. citation from @Keirstead2012??].
<!--
OTHER SCENARIO VARIATIONS
- DSM
- min-cost
- min emissions
- cost/emissions pareto
- export revenue (e.g. hydrogen economy)
- Exergy verses other objectives (cost, carbon footprint, water footprint, waste output)
- min cost -- DSM
- min cost -- phased planning
- min water
- min landfill
- min cost/targets of individual sectors (energy, water, waste), or differently weight them?
-->

## Results (and discussion)

The results for each scenario (namely the variable values) are ouputted by GAMS into a set of CSV files, which can then be processed using R to analyse and plot the results. These results are presented here in a number of ways (summarised in Table [TODO: cross-ref]. This section visualises and describes the results, before the next section discusses their relevance in view of this chapter's aims. This section will first present each scenario's 'headline results' (costs, emissions, waste output and water consumption),Â before giving more detailed views of each scenario (the network of processes, and the schedule of resource imports and exports).

The headline results are given in Figure [TODO: insert figure and cross-ref]. [TODO: insert description of results].

- First, the annual costs (including conversion and transport capital costs, as well as resource import costs), are calculated (Figure [TODO: cross-ref]).
- Second, we consider each system's emissions from the processes (though it is beyond the scope of this study to trace emissions up the supply chain) (Figure [TODO: cross-ref]).

Turning to consider the metabolism of each scenario in more detail, Figure [TODO:] shows which resources are imported into and exported from the area. [TODO: highlight noteworthy similarities and differences between scenarios].

Next we consider the network of conversion processes which makeup each system. These are shown in Figures [TODO: cross-ref]) which are 'social network analysis' (SNA) plots. Each process type used in a scenario is represented by a circle (whose colour indicates the type of process it is[^sna-process-type]. The plots use grey lines to connect any pair of processes in which one process of the pair uses a resource produced by they other. As well as including processes in this diagram, we've included 'imports' and 'exports' (coloured orange) such that they can be imagined as being a process; thus if an imported resource is used in any particular process, then there will be a line connecting imports and said process (likewise for exports). The proximity of any pair of processes is proportional to the degree to which they are dependent on one another. From this, it can be concluded that the more central a process is to the plot, the more its integrated into the network because it tends to be linked to more other processes. Conversely, the closer a process is to the fringe of a plot, the less other processes dependent on this.

Having explained the SNA plots, we can note the following: [TODO: note the difference] 

[^sna-process-type]: This is determined by the 'main' output of each process, as discussed in Section [TODO: cross-ref Chapter 4].

Finally, we consider the transport network in each scenario. [TODO: decide which type of plot to include, notate what they show, and highlight points of note.] 

```{r network-plot, results="asis"}

## Inter-sectoral plot for whole network stored separately, so it's easy to suppress from paper compilation (to save time)
#base::source("resource-network.R")
#
#resource_sectors <- read.csv("resources-sector.csv")
#sectors_lookup <- rbind(c("energy", "blue"),
#			c("water", "red"),
#			c("waste", "black"),
#			c("other", "green"))
#sectors_lookup <- data.frame(sectors_lookup)
#colnames(sectors_lookup) <- c("sector", "node_vector")
#resources_sectors_node <- inner_join(resource_sectors, sectors_lookup)
#node_vector <- c(resources_sectors_node$node_vector)
#
### Network plot (using SNA package)
#layout <-  c("fruchtermanreingold", "kamadakawai", "spring", "circle", "eigen", "hall", "mds", "princoord", "target")
#
##library(sna) # Code to plot figure for saving (and subsequent manual editing)
##gplot(link_matrix,
##      mode=layout[1],
##      gmode="graph",
##      label = resources,
##      label.pos = 1,
##      jitter=FALSE,
###      arrowhead = FALSE,
##      thresh=0,
###      vertex.sides = 0,
##      vertex.col = node_vector,
##      edge.col = rgb(220, 217, 217, maxColorValue=255),
##      displaylabels = TRUE)
```

\begin{figure}
	\centering
	\begin{spacing}{1.0}
%	\includegraphics[width=\columnwidth]{final-network.pdf}
	\end{spacing}
	\caption{The process network used in the design case. Processes are colourd according to the main resource they process. Graph is plotted using the R package from \citet{SNA2005}. A colour version of this plot is available in the electronic version of this paper.}
	\label{fig:sna_interactions}
\end{figure}


[TODO: Dot plot of scenario costs (import, transport, conversion, etc.)].

[TODO: Dot plot of imports and exports. All scenarios on same figure, faceted by resource and scenario].

With some systems so large (over [TODO: number]) process types, space limitations prevent us from display all information of interest (e.g. the quantity of any particular technology). However however, the Supplementary Information includes all results in CSV format.

The number of technologies used by a scenario increases as more are available, showing that systems take advantage of the full range of available conversion processes, with more being used to minimise the objective as much as possible. When different objectives are applied to the same technology choice (e.g. 2a and 2b [TODO: update if necessary]), we observe the sensitivity of the technology mix in the network [TODO: can this be quantified by some metric?].

[TODO: comment on the mix of technology sizes in various scenarios.]
[TODO: comment on which technogies are most relied upon in each system.]
[TODO: comment on transportation reliance (e.g. central import + distribution, or central import and conversion, etc.?]
[TODO: comment on coversion/transportation mix effect on (capital) costs?]

There are limitations to what the results show. We have already noted the approximate nature of process costs. Furthermore [TODO: comment on part-load operation], for the sake of simplicity, our model has aggregated yearly demand to a single per-second value (rather than considering peak and average demand). Thus, we are unable to quantify the degree to which conversion processes within our systems are oversized, without running models with a finer temporal resolution which accounts for variations within a single day.

### Costs

Comment on (percentage) differences between scenarios, and suggest reasons for differences (e.g. capital costs and imports).

### Emissions

Comment on (percentage) differences between scenarios, and suggest reasons for differences (e.g. synergies).

### Metabolic inputs and outputs

Comment on (percentage) differences between scenarios, and suggest reasons for differences (e.g. synergies).

## (Discussion and) Conclusions
<!--
Paragraph ideas from JK's MILP paper
# Conclusions

- "There have been many models developed...however..."
- "In this paper we..."
- "Another feature of the model..."
- "The model was illustrated using..."
- "There are a number of future directions for the model..."
-->

In this chapter we have 
demonstrating how one might go from a site about which some information is known, to develop 
in doing so, we have also provided a rule-of-thumb method to estimate the costs of processes which do not yet exist, and to consider economies of scale in system design.

The overall contribution to this thesis is to [TODO:]. To the field as a whole [TODO:] 

[TODO: Other ideas]

Add text to check whole-thesis build.

TODO IDEAS:

- Shannon Index
- Degree of capacity (e.g. depth of colour of node in network plot) to show redundancy which can fill in for unexpected rises in demand (or drops in resource availability)

