# Case study: a Chinese urban development

```{r Setup, include=FALSE, results="hide", warning=FALSE}
library(knitr)
opts_chunk$set(fig.path = "figures/", dev=c("cairo_pdf"), fig.pos='htbp', fig.width=5, fig.height=3.5, dpi=700, fig.show='hold', fig.lp="fig:", cache=FALSE, par=TRUE, echo=FALSE, results="hide", message=FALSE, warning=FALSE)

library(extrafont)
font_import(pattern="LinBiolinum")

library(ggplot2)
```
<!--
Sections in JK's MILP paper

# Case study

- proposed eco-town development (ambitions)
- site characteristics
- zonal demands
- timings
- figrues with data

## Resources and technologies
## Objective function
## Results
-->

This thesis has argued for the need for an optimisation model which can help plan urban energy, water and waste infrastructure, in combination, with a view to improving the urban metabolism of an area. To that end, the previous chapter introduced the PRaQ model -- a MILP formulation that is generic enough to incorporate multiple resource types, user-friendly to construct, and can be solved without excessive computational effort. The computational implementation of the model is structured to separate code and data, for further ease of use. This chapter now applies this model to a case study, using the library of resource management processes assembled in Chapter 4, and using the metrics of Chapter 3 to assess the systems designed by the model.

The case study is an ongoing Chinese urban development. The development is led by the Xi'an Shann Gu Power Company (SPC), who historically have provided turbo-machinary services (such as steam turbines, fans and energy recovery units) for the chemical industry, power generation, construction, and other sectors requiring heavy machinery [TODO: cite http://www.shaangu.com/ENGLISH/About.jsp?urltype=tree.TreeTempUrl&wbtreeid=1071]. The SPC are currently implementing plans to redevelop one of their industrial sites and the surrounding region. The wider site is in the Xi'an province of China with an area of 51.03 km$^2$, which includes a short-term construction region of 13 km$^2$ which can accommodates 133,000 people. This short-term construction area has residential, commercial, industrial and recreational functions, roughly represented by Figure ~\ref{fig:site} [^confidential].

[^confidential]:The documentation regarding the SPC redevelopment plans is confidential and thus certain information (such as the precise site location) cannot be given here. There are six SPC documents (reports and PowerPoint presentations) from which this chapter draws information. In this thesis, these will be cited as 'SCP [X]', where X refers to one of the six papers, namely: 'energy' (details on energy needs and provision), 'water' (details on water needs and provision), 'sewage' (details on wastewater management needs and provision), 'intro' (general details about the SPC site redevelopment), 'site' (specific details about the site), 'demand' (demand data).

\begin{figure}
	\centering
	\begin{spacing}{1.0}
	\sffamily
	\resizebox{0.5\columnwidth}{!}{\input{06_case-study/site.pdf_tex}}
	\end{spacing}
	\caption{A stylized representation of the SCP redevelopment site, adapted from a figure in the SCP documentation. The outer dashed rectangle encloses the full 13 km$^2$ site; the solid rectangles and their bold text labels represent broad regions within the site (e.g. region nine is \textbf{residential}; the unbolded text labels denote zones more specifically (e.g. a hospital within the residential region).}
	\label{fig:site}
\end{figure}

One stated ambition of the SCP site redevelopment is to integrate the energy, water and waste management services in order to maximise energy efficiency, minimise the discharge of waste, and minimise economic costs. Current plans to that end include using heat held within wastewater within a water source sewage pump, and generating biogas from wastewater fermentation. These, and other intersectoral integration possibilities [TODO: better word?] are summarised in Figure [TODO:], which shows part of the resource management infrastructure proposed for the SPC site, indicating the type of intersectoral integration considered by the planners and decision makers involved with the SPC site redevelopment project.

[TODO: include Figure adapted, showing the interconnections between systems, discuss energy island.]

Some proposed system design have been simulated (for example using the TRNSYS[^trnsys] to simulate the energy, system), however this does not include detailed consideration of the water and waste systems. Furthermore, the system design has not been subjected to optimisation modelling. Thus, this case study presents an opportunity to (i) model water and waste systems, alongside the energy system; (ii) to go beyond simulations by applying optimisation modelling; and (iii) to consider not just the current proposed system designs, but also those made possible when the database of Chapter 4 is considered.

[^trnsys]: \url{http://sel.me.wisc.edu/trnsys/index.html}. This program allows users to lay out the components of an energy system (drawn from a library of thermal and electrical energy components), linking them together in a modular fashion, in order to simulate the behaviour of an overall energy system.

This chapter proceeds by adapting the information from SCP documentation, to construct the model (for example identifying zones, interzonal links, and resource demands). Following this, Section [TODO: subsection number] introduces several scenarios which the model can test. These scenarios will all use the same demand patterns specified in the SPC documentation, but use different objectives, and have different sets of processes available. This will allow investigation of both currently proposed system designs, as well as others. Finally, this model will present and discuss the modelling results, and thus provide insight to planners and decision makers developing SCP site plans further.

<!--
- [SCP-4, slide 17: water, waste and energy jigsawed together]
- [SCP-4, slide 19: Energy island with CHP, CCHP and sewage source heatpump 
- [SCP-4, slide 21: Energy island]
- [SCP-4, slide 22: Energy provision via CHP, CCHP and sewage source heatpump, (as well as traditional and renewable approaches)]
- [SCP-4, slide 25: "Increase energy supply efficiency", "decrease discharge cost" and influence "by cycle reuse", in order to save energy, give social benefits, and economic efficiency]
- [SCP-4, slide 26: Energy island logic diagram, incorporating sewage treatment, water reuse, solid waste treatment, cooling/heating, and solar-PV power]
- [SCP-4, slide 27: Within that, the "Combined water supply and treatment system" has WSHP, rainwater collection, fermentation to produce biogas, sewage plant, water treatment, and water reclamation]
-->

## Model data
<!--
- Data
  	- resources
  		- generic
  		- specific, due to the site, e.g. exergy of heat
  	- processes
  		- generic, from the database
	  	- specfic, due to the site, e.g. rain, leachate = f(rain, evaporation, landfill area)
		- real processes, heat exchangers (and associated water flows)
		- dummy processes (e.g. MSW splitting, waste generalising)
-->

When applying the model to a case study, the first step is to specify the zones and time steps [TODO: better word? slices?] used in the model, which are indexed by $z$ and $t$, respectively. With the zones determined, another a set specifies whether any pair of zones $(z,z')$ are neighbours, defined as any pair of zones which exist in the $nb(z,z')$ set. Following this, the sets of processes and resources available to the model can be specified, indexed by set $p$ and $r$, respectively. Once the resources have been specified, there is enough information to define the two final sets: first, quality attributes which should be defined (specified by a set indexed by $q$); and second, the transport technologies which can transport the resources between zones (indexed by $\tau$).

With the sets specified, their related parameters can be defined. First the distance between between two any two neighbouring zones defines the $l_{zz'}$ parameter (km), while the $span_t$ parameter defines the length of time (days) of each time step lasts. The resource demands can then be specified for each time and location with the $D^{(qty}_{rzt})$ parameter. (As mentioned in Chapter 5, the model code is built so that it will automatically define the $D^{(qual)}_{qzt}$ parameter.) Other parameters will include the limits on imports and exporting resources to particular zones, and the costs of resources and processes [TODO: TBC].

This section gives the key particulars on how the sets and parameters above are defined from the SPC documentation, with further details provided in Appendix [TODO: cross-ref]. The explanations are deliberately comprehensive, reflecting on why certain decisions and assumptions regarding data are made, with the intention of justifying modelling decisions taken here, as well as walking the reader through how one might design a model for a particular case study, and when it would be appropriate to take different decisions.

```{r resource-demands, fig.height=5, fig.cap="Resource management demands for the SCP site, according to zone and season. Negative values for (i.e., for wastes and wastewaters) indicate the production of a resource.\\label{fig:site-demands}"}
demands <- read.csv("06_case-study/resource-demands.csv")

#library("dplyr")
#filter(demands, value.conv!=0)

plot_demand <- ggplot(demands, aes(zone, value.conv)) +
  geom_dotplot(aes(fill=season), binaxis="y", position=position_dodge(width=0.6)) +
  facet_wrap(~resource) +
  xlab("Zone") +
  labs(fill="Season") +
  theme_bw() +
  theme(axis.text.x = element_text(hjust=1, angle=30),
	axis.title.y = element_blank())
plot_demand

```

[TODO: adapt Appendix from supplementary information (shann-gu-case-study/paper/supInf.Rmd)]

### Site layout

Each of the twelve zones shown in Figure \ref{fig:site} (both the three larger regions, and the nine functions they encompass) will be modelled in this case study, and thus each are encoded in the model as zones $z \in Z$, where $Z=12$. The parameter which defines site layout is $l_{zz'}$, which specifies the distance between any $z,z'$ pairs belonging to set $nb(z,z')$. All this information for the SPC case study is shown on Figure [TODO:], in which the zones and regions from Figure \ref{fig:site} have been translated into the zones for the model. Note then that in this model, to be a 'neighbour' is not primarily a function of geographical proximity, rather it is one of 'connectedness'.

[TODO: insert a figure which is a zonal representation of the site, marked with interzonal distances.]

Thus to define the site layout, we first assume which pairings belong to set $nb(z,z')$, and then estimate the lengths of these connections. For the SPC site, we will assume that roads are assumed to exist along any connection. Additionally, these connections can optionally include underground pipes and overhead cables, running along the length of the road[^road-cost].

[^road-cost]: As discussed in Section [TODO:], this means that roads have no financial cost in the model, whereas pipes and cables will.

We will assume that the three broader regions will be linked via a connection running north-south through the site. Then we assume that the functions within a particular region are equidistant from the region's centre (with the exception of the energy island which does not belong to a region). This makes the size of set $nb(z,z')$ as $NB=12$. With the connections determined, the distances are estimated, based on the site's dimensions. We assume that the region-to-region connections join the regional centroids, thus distances can be measured by scaling distances from the site plans in the SCP documentation. The region-to-function distances will be assumed as [TODO:] km.

[TODO: insert a photo of me with a ruler, doing the measurements!]

The GAMS code for this data is listed in Appendix [TODO:]. 

<!--
Assembly,Factory (south)
Factory (north),Factory
Multifunction district,Factory (north)
Technology building,Factory (north)
Dormitories,Factory (north)
Energy island,Multifunction district
Technology building,Turbines
Quality,factory_blades
school,Residential
school,hospital
school,energyIsland
school,reserved
-->

### Times

The SPC [demand] provides values of zonal energy demands for winter, summer and year round. This model therefore uses three timesteps, specified by $t \in T$, where $T=3$, representing the winter, summer, and shoulder seasons. This means that the infrastructure selected by the model would be in place all year round, but could operate differently in each season. Consider the provision of domestic heating provided by district heating as an example: in the winter, the district heating would be delivering heat to homes, and this would have an impact on the operation of heat-generating processes upstream. However, these upstream impacts would not occur in the summer, when district heating does not run. As this phenomenon is applied in relation to other resource demands, the chain of processes emerging from the system interactions could operate differently according to season, in order to optimise the site's metabolism.

Of course, operation might not just vary by season, but could vary for smaller time slices. For example each season could have alternative weekday and weekend resource demand (thus $T=3 \times 2 = 6$), which could further be divided into hourly demands (thus $T=3 \times 2 \times 24 = 144$). The temporal resolution could become finer still, using minute-by-minute and second-by-second demand patterns. However, the choice of seasonal timesteps has at least three reasons. The pragmatic reason, is that this is how the SPC documentation defines the energy demands. The philosophical [TODO: better word? modelling judgement] reason is that seasonal time slices are appropriate to the exploratory early-stage planning purposes of this model [TODO: cite examples of similar models, e.g. MARKAL etc.] . Finer resolution would be appropriate the further along the design process the modelling is. However, modelling judgement is also the reason why it is inappropriate to aggregate the demand up to a coarser scale (i.e. a year). In such a case, a yearly averaged value of head (to take one example) would overdesign the summer system operation, while undersizing the winter system operation, potentially resulting in a suboptimal system design [TODO: clarify this]. Finally, there is a computational reason. As shown in Chapter 4, if $T$ doubles, the number of variables increases by [TODO:], leading to an estimated [TODO: X-fold] increase in computation time. [TODO: note on heirarchical time discretisation, for a more tractable approach, to be explored in future.] These latter two points interact, as the further along the planning process (from explanation to detailed design), it is justifiable to expend more effort (including computational resources), thus a finer temporal resolution may be warranted. Further more, at the more detailed design stages, some decisions will have been made (the location of a particular conversion process, whilst its size remains unknown, for example), thus reducing the number of variables in the model, and thereby making some efficiency savings to the computations.

With this set of times chosen, the length of each timestep is defined as parameter $span(T)$ with the winter, summer, and shoulder seasons having spans of 90 days, 90 days, and 180 days respectively.

### Resource demands

The Shann Gu documentation specifies demands ($D^{(qty)}_{rzt}$) for electricity, heating, water consumption. We also derive quantities for wastewater and waste generation, which can be defined using negative values. Demand is defined on a per-second basis (MW for energy demands, kg/s for the others).

These are visualised in Figure \ref{fig:site-demands}, with site-wide values tabulated in Table [TODO:]. Appendix [TODO:] includes separate tables for each zone.

This necessarily requires [TODO:] quality attributes.

### Resource demands -- Appendix

- The code is set up, such that only $D^{(qty)}_{rzt}$ need be defined, with $D^{(qual)}_{rqzt}$ defined automatically.
- Summary table?

### Resource options

As well as the resource demands, our case studies consider another [TODO: number] resources in set $R$ which can be used as part of the conversion chain to meet demand. These include [TODO: list examples]. For each resource why can apply a conta

Each resource has at least one associated quality $q$, which are defined in the $Q$ set. For our purposes we use `mass` and `energy` qualities, which are attributed to each resource with the $X_{rq}$ parameter.

For each resource, we need to define the minimum and maximum allowable imports and exports (again, on a per-second basis), and the number of zones allowed to import or export any particular resource. We also define a cost to import each resource [TODO: source information].

### Process options

Our modelling considers up to [TODO: number] processes $p$ which convert resources (depending on the scenario). [TODO: add details on scenarios here, or elsewhere?] These processes are taken from the open-source database of urban metabolism processes outlined in @Ravalde2015b[^process-data], or the Shann Gu documentation. Each process definition also includes its capacity (i.e. the maximum MJ/s or kg/s which can be converted).

For each process, we also provide an estimated cost (in USD). Apart from the shear number of processes in our database (over 300), several factors make this tricky: first and foremost, our process database considers future processes which have not yet penetrated into the market. In addition, exchange rates and purchasing power parities around the world make it difficult to cost a process with any degree of certainty. For this reason, our costing is approximate. Nevertheless, this is important to get plausible results. (See the supplementary information for references, assumptions, calculations, and other details.)
). 

Similarly, up to [TODO: number] transport processes are also defined (using the $k$ coefficients), and maximum transport rates (MW or kg/s).

- pipes (costed)
- roads (free)

## Model scenarios

We study [TODO: number] scenarios using different subsets of the processes, to suggest how different networks of processes can satisfy demand under varying circumstances (following the methodology of @Keirstead2012). For some scenarios, we model sub-scenarios, where we use different objective functions, or introduce an additional constraint to illustrate Pareto optimality. The scenarios are:

1. *Base case.* This assumes that electricity, fuels and water are imported to the site as needed (with wastewater treated on site), thus there is no attempt to take advantage of synergies. As such, this scenario provides baseline results.
2. *Design case.* The Shann Gu site developers intend to take advantage of intersectoral synergies to minimise resource consumption. This scenario considers the processes suggested in the Shann Gu documentation, including combined heat and power (CHP), a wastewater source heatpump combined with a district heating network. We consider how the process choice changes, with different objecitves:
	a. Minimise cost
	b. Minimise emissions
	c. Minimise waste
	d. Minimise freshwater consumption
3. *Wildcard case.* This scenario allows any process from the database compiled by @Ravalde2016 to be incorporated into the site's resource management network. This database includes both existing and still-to-be-implemented management processes, so we consider the following sub-scenarios, at minimum cost:
   	a. Currently available processes
   	b. Medium-term available technologies
   	c. Long-term available technologies

Scenario 3a [TODO: update if necessary] is the largest, and thus indicates the computational effort required to solve the problems, having [TODO: number] single variables, [TODO: number] discrete variables, [TODO: number] binary variables, [TODO: number] equations [TODO: etc.].

These scenarios are fairly simple, and illustrate the sensitivity of a network to fairly broad considerations (technology availability, and simple objective functions). Detailed design problems should be more narrowly focussed, by applying sensitivity analysis to understand how a system design responds to changes in efficiency (reducing demand), market value of imported and exported goods, and other factors. [TODO: reproduce Saltelli et al. citation from @Keirstead2012??].
<!--
OTHER SCENARIO VARIATIONS
- DSM
- min-cost
- min emissions
- cost/emissions pareto
- export revenue (e.g. hydrogen economy)
- Exergy verses other objectives (cost, carbon footprint, water footprint, waste output)
- min cost -- DSM
- min cost -- phased planning
- min water
- min landfill
- min cost/targets of individual sectors (energy, water, waste), or differently weight them?
-->

## Results (and discussion)

We present the results of each scenario in a number of ways (summarised in Table [TODO: cross-ref]. First, the annual costs (including conversion and transport capital costs, as well as resource import costs), are calculated (Figure [TODO: cross-ref]). Second, we consider each system's emissions from the processes (though it is beyond the scope of this study to trace emissions up the supply chain) (Figure [TODO: cross-ref]). Third, we consider the metabolic inputs and outputs to each system (Figure [TODO: cross-ref]). Fourth, we consider the network of conversion processes which makeup each system (Figure [TODO: cross-ref]).

[TODO: SNA (or triangular grid) figures for each scenario]


```{r network-plot, results="asis"}

## Inter-sectoral plot for whole network stored separately, so it's easy to suppress from paper compilation (to save time)
#base::source("resource-network.R")
#
#resource_sectors <- read.csv("resources-sector.csv")
#sectors_lookup <- rbind(c("energy", "blue"),
#			c("water", "red"),
#			c("waste", "black"),
#			c("other", "green"))
#sectors_lookup <- data.frame(sectors_lookup)
#colnames(sectors_lookup) <- c("sector", "node_vector")
#resources_sectors_node <- inner_join(resource_sectors, sectors_lookup)
#node_vector <- c(resources_sectors_node$node_vector)
#
### Network plot (using SNA package)
#layout <-  c("fruchtermanreingold", "kamadakawai", "spring", "circle", "eigen", "hall", "mds", "princoord", "target")
#
##library(sna) # Code to plot figure for saving (and subsequent manual editing)
##gplot(link_matrix,
##      mode=layout[1],
##      gmode="graph",
##      label = resources,
##      label.pos = 1,
##      jitter=FALSE,
###      arrowhead = FALSE,
##      thresh=0,
###      vertex.sides = 0,
##      vertex.col = node_vector,
##      edge.col = rgb(220, 217, 217, maxColorValue=255),
##      displaylabels = TRUE)
```

\begin{figure}
	\centering
	\begin{spacing}{1.0}
%	\includegraphics[width=\columnwidth]{final-network.pdf}
	\end{spacing}
	\caption{The process network used in the design case. Processes are colourd according to the main resource they process. Graph is plotted using the R package from \citet{SNA2005}. A colour version of this plot is available in the electronic version of this paper.}
	\label{fig:sna_interactions}
\end{figure}


[TODO: Dot plot of scenario costs (import, transport, conversion, etc.)].

[TODO: Dot plot of imports and exports. All scenarios on same figure, faceted by resource and scenario].

With some systems so large (over [TODO: number]) process types, space limitations prevent us from display all information of interest (e.g. the quantity of any particular technology). However however, the Supplementary Information includes all results in CSV format.

The number of technologies used by a scenario increases as more are available, showing that systems take advantage of the full range of available conversion processes, with more being used to minimise the objective as much as possible. When different objectives are applied to the same technology choice (e.g. 2a and 2b [TODO: update if necessary]), we observe the sensitivity of the technology mix in the network [TODO: can this be quantified by some metric?].

[TODO: comment on the mix of technology sizes in various scenarios.]
[TODO: comment on which technogies are most relied upon in each system.]
[TODO: comment on transportation reliance (e.g. central import + distribution, or central import and conversion, etc.?]
[TODO: comment on coversion/transportation mix effect on (capital) costs?]

There are limitations to what the results show. We have already noted the approximate nature of process costs. Furthermore [TODO: comment on part-load operation], for the sake of simplicity, our model has aggregated yearly demand to a single per-second value (rather than considering peak and average demand). Thus, we are unable to quantify the degree to which conversion processes within our systems are oversized, without running models with a finer temporal resolution which accounts for variations within a single day.

### Costs

Comment on (percentage) differences between scenarios, and suggest reasons for differences (e.g. capital costs and imports).

### Emissions

Comment on (percentage) differences between scenarios, and suggest reasons for differences (e.g. synergies).

### Metabolic inputs and outputs

Comment on (percentage) differences between scenarios, and suggest reasons for differences (e.g. synergies).

## (Discussion and) Conclusions
<!--
Paragraph ideas from JK's MILP paper
# Conclusions

- "There have been many models developed...however..."
- "In this paper we..."
- "Another feature of the model..."
- "The model was illustrated using..."
- "There are a number of future directions for the model..."
-->

[TODO: Other ideas]

Add text to check whole-thesis build.

TODO IDEAS:

- Shannon Index
- Degree of capacity (e.g. depth of colour of node in network plot) to show redundancy which can fill in for unexpected rises in demand (or drops in resource availability)

# Case study appendix content 

This webpage gives further detail on the data used in the case study outlined in @Ravalde2016b. Specifically we:

- present summaries of the data
- provide links to the data (in CSV and YAML formats)
- note data sources, along with assumptions and calculations used to convert the data into appropriates values and units
- [TODO: if time] Show how it can be converted to be used in GAMS modelling (using the R programming language)

All of the above can be found from this webpage. Furthermore, since the source of this page was written in [Rmarkdown](http://kbroman.org/knitr_knutshell/pages/Rmarkdown.html) format before its conversion to HTML, by downloading the [supInf.Rmd](supInf.Rmd) source of this page, you can get the R-code used on this page to manipulate the data, for your own interest.

The next section outlines the data in the order in which we presented it in @Ravalde2016b in the subsection titled 'Input data'.

## A note on sources

Some of our data and assumptions come from seven documents (Word documents and PowerPoint presentations) provided by the Shann Gu company and their collaborators. This documentation is not publicly available. We will list these references using a square-bracketed number between 1 and 7, e.g. [3].

Other sources will be referenced by links.

## Input data

### Site layout

Any size used in the model needs to be defined as a number of zones. For the Shann Gu model we use the thirteen zones listed on slide 20 of [6]. Each zone belongs to a region. 

Region, Zone
south, factory
south, factory_assembly
production, northDistrict
production, multifunction
production, factory_blades
production, tech
production, quality
production, dormitories
residential, residential
residential, hospital
residential, school
energyIsland, energyIsland
NA, reserved

Next we define which of the above zones can be directly connected by transport links. This is done from a visual inspection to identify neighbouring zones from slide 20 of [6]. At the same time, we can define the distance between such neighbouring zones using a origin-destination matrix [zones.csv](../modelling/data/zone-matrix.csv). Any origin-destination pair which is are not neighbours are denoted with `NA` in its cell (e.g. `factory-northDistrict`). The other cells contain the distance between zones, in kilometers (e.g. `factory-factory_assembly` has a distance of [TODO: number]). This matrix is lower-triangular, so there is no need to define a distance in both directions (we assume these are equal).

The distances have been assumed as being approximately [TODO: number] km, based on the overall site being 13 km^2.

[TODO: add the code used to define the distances]

### Times

Our case study's time steps (along with their lengths in seconds) are defined in the [times.csv](../modelling/data/times.csv) file.

We have assumed a 360 day year, with the winter, summer and shoulder seasons taking lengths of 90 days, 90 days, and 180 days, respectively. So for example, the length of the `shoulder` season is calculated as $180~\mbox{days} \times 24~\mbox{hours} \times 3,600~\mbox{seconds} = 1.5552 \times 10^7~\mbox{seconds}$.

### Resource demands

The following demands zones are given in the Shann Gu documentation:

- Slide 20 of [6]: `heat` (winter), `cool` (summer) and `elec` (year-round).
- Slide 26 of [5]: `waterPotable`, and `water_reclaimed` as well as rates of `wastewater` generation
- Slide 28 of [5]: rates of `waste` generation (both organic and non-organic)
 
Not that waste and wastewater generation rates are defined as negative demands, for use in our model.

The waste generation figures from the Shann Gu Documentation are not provided in the same units (total solid waste = 8m3/day, organic waste = 360,000 kg/year), so we perform the following calculations to get separate values for `waste` and `waste_organic`:

Assume solid waste has a density $\rho=217.5~\mbox{kg/m3}$[^waste-density], thus:

[^waste-density]: Table 2.2 from [Solid Waste Management by Chandrappa and Das](http://www.springer.com/cda/content/document/cda_downloaddocument/9783642286803-c2.pdf?SGWID=0-0-45-1336211-p174308664) gives a density range of 87--348 kg/m3. We take the median value of 217.5 kg/m3.

$$
\begin{align}
\mbox{Total solid waste} &= 8~\mbox{m3/day} \\
 		  &= 1,740~\mbox{kg/day} \\
 		  &= 635,100~\mbox{kg/year}
\end{align}
$$

Subtracting the organic waste fraction: 

$$
\begin{align}
\mbox{Non-organic waste} &= 635,100 - 360,000~\mbox{tons/year} \\
 		  &= 275,100~\mbox{kg/year}
\end{align}
$$

Having identified the site's resource management demands, we next make assumptions and calculations to appropriately redistribute some demands between multiple zones, before converting all demands to a consistent set of units (MW for energy, kg/s otherwise).

In [resource-demands.csv](resource-demands.csv), we detail both the original data taken from the Shann Gu documentation, and any subsequent assumptions and calculations applied to that data. We now briefly outline this file's columns (denoted by **bold** text):

- **zone.region** and **zone** are those regions and zones referred to in the Site Layout section above. 
- The documented demand for a resource in any given season is denoted using the **resource**, **season**, and **value.doc** columns, with the units and reference given in **units.doc** and **reference**.
- When the Shann Gu documentation gives little detail about the spatial disaggregation of the demand (i.e. demand is only attributed to a region, rather than a zone), we make an assumption about how to divide this demand up between zones. Similarly, when the documentation has not provided a demand value for a particular season, we make assumptions (e.g. we have assumed that the shoulder heat demand is half the winter heat demand). This information is recorded in **assump.redist**, with the new values listed in **value.redist** (and units given in **units.redist**)
- Finally, **notes.conv** notes any necessary changes in units, such that **value.conv** and **units.conv** contain resource demands in a consistent set of units.
<!--
- More notes and calculations (for authors' use) in data-notes.ods.

Example of how to convert documented electricity demand (kWh/year) to units required by the model (MW):
$$
\begin{align}
111700000 \times 3.6/(365 \times 24 \times 3600) &= 12.75 \\
6e7 \times 3.6/(365 \times 24 \times 3600) &= 6.85
\end{align}
-->

In summary, the reasoning for every demand value which appears in our case study can be justified by the chain of sources, assumptions, and calculations embedded in our CSV file.

The data is recorded in CSV format in [resource-demands.csv](resource-demands.csv). Below are all rows from this dataset in which the **value.conv** column contains a non-zero value (i.e. all the resource demands to be in our case study), along with the R required to extract these rows.

```{r data-head, echo="TRUE"}
demands <- read.csv("resource-demands.csv")

library("dplyr")
filter(demands, value.conv!=0)

## Arranged according to zone
#demands_nonzero <- demands %>% arrange(zone.number) %>% select(zone, resource, season, value.conv, units.conv) %>% filter(value.conv!=0)
#
## Save for use in GAMS model
#write.csv(demands_nonzero, "../modelling/data/demands-nonzero.csv", row.names=FALSE)
```

### Resource options

As well as the resource management demands specified above, our case study considers other resources which can play a part in the conversion chain of processes which meet demand (e.g. coal can be used in a power plant which also requires cooling water, and emits carbon dioxide).

These resources are defined using the YAML format, by which which define a resource's name (e.g. `coal`), and also define quality attributes $X_{rq}$ (e.g. `mass`), for example:

```yaml
resource: coal
quality:
        mass: 1
notes:
```

The YAML files for all [TODO: number] resources for our model are available [here](../modelling/data/resources-yaml). [TODO: link to GitHub, or convert to zip?]

For each resource, we also need to define parameters including its seasonal import and export limits, the number of zones allowed to import and export it, and its cost. We tabulate all this in CSV format: [resource-params.csv](../modelling/data/resource-params.csv). This data also includes sources, assumptions and calculation steps used to estimate resource costs. The top few rows of this data set are shown below.


```{r data-params-head, echo="TRUE"}
params <- read.csv("../modelling/data/resource-params.csv")
head(params)
```

### Process options

We also use YAML files to define the characteristics of the processes which convert and transport resources, as outlined below.

#### Conversion processes

For each conversion process, a YAML file defines the relative quantities of input and output `resources`, and the maximum capacity (or `rate`) at which a process can operate. For example, a coal-fuelled power plant is defined thus:

```yaml
process: elecplant-coal-l
resources:
     coal: -0.1012658
     elec: 1
     heat: 1.56962
     water: -0.8670886
     CO2: 0.2341772
     ash: 0.01012658
rate:
        wint: 5400
        sum: 5400
        shoulder: 5400
notes:
```

The processes main output (`elec` in this case) is always set to a value of `1`, such that the `rate` multiplied by any resource flow will give the maximum input or output of any resource.

The YAML files for all the processes used in our case study are available [here](../modelling/data/processes-yaml). [TODO: link to GitHub, or convert to zip?]. This data comes from two sources:

- a few processes have been defined using information from the Shann Gu literature
- the remaining majority of process definitions are adapted from the publicly available [database of urban metabolism processes](https://github.com/tomravalde/urban-metabolism-process-database) which is introduced in @Ravalde2016.

We also define each process's cost in [process-costs.csv](../modelling/data/process-costs.csv). As discussed in the paper[^process-costs], various factors make estimating process costs tricky. However, to run the model, it is helpful to have plausible process costs.

[^process-costs]: Considerable effort is required to research the costs of each process, especially given that some technologies are still under research -- economic forecasting is beyond our scope. Even apart from these unknowns, there are other complicating factors, including variations in purchasing power parities and exchange rates, as well as the different environmental constraints/conditions into which a process is built.

Our approach is to build a database of general processes ($GP$) for which we can have a unit cost (USD/MW or USD/kg/s) for each process. We can then assign each model process ($MP$) with a $GP$ (indicated by the [TODO: relevant column] column in process-costs.csv). For processes which do not yet exist [TODO: e.g. <example>], we use a GP which produces/consumes a similar main resource. Once each MP has an associated GP Unit Cost, we can estimate the an MP Total Cost (USD) by calculating:

$$
\begin{align}
\mbox{MP Total Cost} = \mbox{GP Unit Cost} \times \mbox{MP Flow Rate}
\end{align}
$$

So that our modelling accounts for economies of scale, each GP has both lowerbound and upperbound unit costs, with the former being applied to larger instances of a process, and the latter applied to a smaller instance. To estimate $\mbox{GP Unit Cost}$, we research the literature, and apply appropriate assumption, conversions and calculations, all of which can be traced in [process-cost-calcs-kgyr.ods](../modelling/data/process-cost-calcs-kgyr.ods). The terms in **bold** refer to column headers in the spreadsheet.

1. From our list of MPs, we assemble a list of suitable GPs (which can apply to more than one MP)
2. For each GP, we list a lowerbound and upperbound versions, appending `_l` and `_u` to the process names, respectively (e.g. `CHP-biogas_l` and `CHP-biogas_u`). These GPs are listed in the **process-type** column.
3. We find costs for each process type (indicating this using **ref.cost** and **ref.currency**, with the **reference** column providing a link to the source)
4. If necessary we convert this value to USD in the **ref.USD** column.
5. The referenced cost will correspond to a particular resource and its production (or consumption) rate. For example, a CHP cost may be per kW of electricity produced. The resource, its quantity, and its units, are recorded in **ref.flow**, **ref.flow.value** and **ref.flow.units**, respectively.
6. We can then calculate a **ref.flow.mult.factor** which is the number by which the **ref.flow.value** should be multiplied, in order to convert the flow into a consistent set of units (MW for energy resources, kg/s otherwise). Any relevant notes (e.g. the density of a material) are recorded in **mult.factor.notes**.
7. Finally we can calculate a **ref.unit.cost** each process-type (USD/MW or USD/kg/s) by calculating **ref.USD**/(**ref.flow.value** $\times$ **ref.flow.mult.factor**).

#### Transport processes

For each transport process, a YAML file defines the resource carried between an origin and destination using `inputs` and `outputs` respectively. In the example of coal transportation below, now coal is lost between the origin and the destination. The `rate` mapping defines the maximum transport rate (MW or kg/s). The YAML file also defines the quantity of any resource consumed/produced in that activity, in this case gasoline consumption and CO2 emissions. We split these values equally between the origin and destination zones.

```yaml
process: road_coal
inputs:
        coal: -1
        gasoline: 0
        CO2: 0
outputs:
        coal: 1
        gasoline: 0
        CO2: 0
dist_source:
        coal: 0
        gasoline: -0.18
        CO2: 0.3
dist_dest:
        coal: 0
        gasoline: 0
        CO2: 0.3
rate: 100
notes:
```

The remaining transport processes can be found in [transport-yaml](../modelling/data/transport-yaml). We also provide [calculation details](transp-process-calcs.html) for electricity, pipe flow (water), pipe flow (gas), and vehicle transport).

The transport costs are defined per kilometer in [transport.csv](../modelling/data/transport.csv), which also gives references.

## Model scenarios

- All the above data can be subsetted according to appropriate scenarios
- YAML configuration files define which subset of data to be used
- Our R script then turns this into a model instance

### List the YAML files for each scenario in our paper

## Summary

Summary text.
