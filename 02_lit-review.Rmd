```{r Setup, include=FALSE, results="hide", warning=FALSE}
opts_chunk$set(fig.path = "figures/", dev=c("pdf", "png"), fig.pos='htbp', fig.width=5, fig.height=1.6, dpi=700, fig.show='hold', fig.lp="fig:", cache=FALSE, par=TRUE, echo=FALSE, results="hide", message=FALSE, warning=FALSE)

#library(extrafont)
#font_import(pattern="LinBiolinum")

```

# Urban metabolism and systems optimisation

\epigraph{
\begin{description}
\item [Assistant 1] ``So minister, we've run every viable model through the computer and it looks there are just no easy solutions to this recession.''
\item [Assistant 2] ``Yeah, raising VAT, cutting VAT, raising interest rates...''
\item [Assistant 1] ``... raising interest rates and VAT, lowering income tax and raising VAT...''
\item [Assistant 2] ``None of it seems to really help.''
\item [Minister] ``Have your tried kill all the poor?'' ... ``I'm not saying do it, I'm just saying run it through the computer, see if it would work.''
\end{description}
}{Extracts of a sketch from \emph{That Mitchell and Webb Look} (BBC Television, Series 4, episode 4)}

\begin{tcolorbox}

Section \ref{sec:UM-review} has been adapted from \citet{Ravalde2015a} (Section 2, entitled `Urban metabolism and sustainability'), and \citet{Ravalde2016} (Section entitled `Approaches to Urban Metabolism').

\end{tcolorbox}

This chapter reviews two key bodies of research to show to what extent the research question (Section \ref{sec:research-qn}) has been answered. The first subject of exploration shows how the UM field has developed to better understand issues or urban resource management, and identifies how ideas of UM should be further developed so it is equipped to address the concern of this thesis, namely how resource management processes affect an area's metabolism. The second introduces the various ways modelling has been used to optimise the performance of resource management systems. This chapter's work feeds into the first aim of the research question.

## The past, present and future of urban metabolism research {#sec:UM-review}

UM was introduced in 1965 by the American engineer Abel Wolman. He recognised that resource consumption was necessary to sustain urban living, but wanted to make a close study of this because of his concerns that as cities grew, their rising material and energy inputs and outputs presented challenges for public management of water supply, sewage disposal and air pollution. In that cause, he coined the phrase 'urban metabolism', defining the metabolic requirements of a city as "all the materials and commodities needed to sustain the city's inhabitants at home, at work and at play" [@Wolman1965, p.156, *Scientific American*]. To elucidate the issues, Wolman quantified the material and energy inputs and outputs of a hypothetical city of one million inhabitants. This kind of accounting exercise -- known as material flow analysis, and energy flow analysis -- is typically the fundamental building block of UM studies. In this seminal work of Wolman are the two key elements typical of UM studies: first, the quantification of urban resource flows; second, some assessment of how these flows relate to other aspects of the city -- in Wolman's case, this was the challenges of "public economic" decision making (p.156).

Since Wolman the UM framework has cultivated a whole field of studies which seek to understand the scale and origins of urban consumption and waste, and its relationship to an area's form, geography, and other characteristics. A more recent definition of UM which encapsulates the current breadth and depth of the field is given by @Kennedy2007, who defines UM as "the sum total of the technical and socioeconomic processes that occur in cities, resulting in growth, production of energy and elimination of waste" (p.44). Since initial steady growth in UM studies, there has been a recent rise in research facilitated by conferences, journals, and research collaborations [@Zhang2015a], and most recently @Kennedy2015a has, through collaboration with researchers worldwide, conducted UM studies of 27 global megacities.
 The field has grown such that 'urban metabolism' is fast becoming a buzzword in urban research literature, perhaps enjoying the benefits of increased data availability in conjunction with "an explosion of research on cities and on sustainability in recent years" [@NextCity2014]. @Kennedy2012a write of the "substantial momentum" (p.781) to its study and highlight its usefulness to "address concerns over the magnitudes of global resource flows" as well as the "analysis of specific policy issues" (p.780). Thanks to UM's close association with 'sustainability', the UM concept is helping planners and policy makers understand and address urban sustainability issues, and is even employed by governments seeking approaches to urban sustainablity (for example, in the United Kingdom, by @Clift2015).

<!--
its basic function is to highlight how cities can sustain their developing forms and socioeconomic functions, but with less harmful resource (forms, functions and flows). @Zhang2013's review mainly focuses on the flows ("research on urban metabolism therefore focuses on the sources and consumption of resources, and on their cycling within the system plus the emission, treatment, and recycling of wastes"). 
-->

### Methods

Typically, the methodology to conduct a UM study begins by defining a boundary around an urban area, and then quantifying the *flows* of material, energy, water and other resources into and out of a city (i.e. crossing the urban boundary) over a given time period, and/or the *stocks* of these resources held within the boundary [@Kennedy2014]. These quantities can be found either by consulting data sources, or using estimations and calculations[^method-details]. A recent important example is the UM study which quantified the energy and material flows of 27 megacities [@Kennedy2015]. Once stocks and/or flows have been quantified, there are then at least four types of study (identified from a survey of the literature):

[^method-details]: More details on these methods are given in Section \ref{sec:procs-in-UM}.

<!--
Studies of an area's metabolism can take a number of forms, focussing on the different elements of an urban system summarized by @Ravalde2016's hierarchical representation illustrated in Figure \ref{fig:metab}. Resource demand and waste generation at the bottom drives aggregate resource exchanges between a city and the environment at the top. In the middle, are the processes which convert and transport resources. We can use this representation, along with the 'top', 'middle' and 'bottom' terminology to outline the types of UM modelling that exist.

- Some work provides **top of system understanding** in the form of **accounting** exercises to quantify a city's resource flows at the top. The results of these can be used to to compare between cities(these results can also be used to calculate carbon footprint, ecological footprint and other metrics). [TODO: as in REFERENCE]. Or they can be used to related to other variables of interest [TODO: reference: e.g. water levels in Toronto]
- Elsewhere, UM studies seek to provide **top-bottom system understanding**, by relating such resource flows (or stocks) at the top to aspects of a city, building from the bottom up.
  	- @Ye2011: deterministically relates household construction characteristics to greenhouse gas emissions.
	- @Kellet2013 builds up emissions from building, transport, human, and vegetation sources.
	- @Baynes2012a: sectoral energy demand and upstream energy consumption
- Elsewhere, UM studies seek to provide **top-city system understanding**, by relating such resource flows (or stocks) at the top to aspects of a city such as resource flows at the top to socioecnomics, geography, urban form, etc. [TODO: add reference]. These could then be used to carry out scenario analysis, strategic planning
  	- @Liang214: statistically relates a city's quantity of steel stock with levels of nightime lighting
  	- @Fischer-Kowalski2004: society size and transport volume
	- @Fung2005: relates sustainability to instituational activities
	- @Hung2005: relates energy flows to urban development
  	- @Newman1999a: (theoretically) relates resource flows to urban form and 'livability'. 
- Elsewhere, UM studies seek to provide more **top-middle system understanding**, by relating such resource flows (or stocks) at the networks of processes in the middle (e.g. ENA) [TODO: add reference]. These could then be used to inform interventions, scenario analysis, strategic planning
  	- @Zhang2010: ENA to related resource flows of a city's 17 economic sectors to each other
- **middle-bottom system understanding**
  	- @Zeng2014: simulate water flows between the processes (e.g. water reclamation) and demands in an urban system, to show how demands under changing population scenarios
	- Similarly @Liang2011 resource consumption and waste emission objectives -- [TODO: leave, for now]
- Other (e.g. theory)

In coming to an understanding of **-middle** systems, some models choose to unite all resource flows under a single measures, such as @HUang2005 who use emergy. Others 
-->

- *To provide inputs to other types of analysis.* Useful information can be calculated when inventories of resource flows are coupled to other data for further analysis.  For example, by combining metabolic flows with carbon intensity factors, a city's greenhouse gas emissions can be calculated (with examples in @Kennedy2009 and @Kennedy2010). The 'ecological footprint' (EF) is another quantity that can be calculated from UM data [@BFF2002]. @Zucaro2014 use UM data to calculate 'urban sustainability indicators' for Rome, including emissions, acidification and emergy flows.
- *To make comparisons of resource consumption.* This type of study identifies trends or differences in resource flows, either over time, or between cities. For example, @Kennedy2007 studies the metabolism of eight metropolitan regions around the world since 1965, and, amongst other findings, shows that in general, there is an increase in per capita energy and consumption, and waste output (with some exceptions, such as Toronto's energy and water use). Alternatively, resource flows could be compared for cities at different stages of their development -- for example, @Krausmann2008 compare the metabolism of agrarian, developing and industrialised societies. Comparison studies might focus on just a single city, and compare the resource flows between its different sectors (such as construction or commercial services), for example to determine which sectors produce the most waste [@Browne2009].
- *To relate consumption/output to other dependent variables.* Wolman's 1965 study is an example of this type of study, in which he relates resource flows with challenges of water supply, sewage disposal, and air pollution. Other studies highlight looking at the relationship between flows and challenges include @Browne2009, who consider impacts of waste generation; and @Kennedy2007, who addresses issues of water stress and contamination. Another type of relationship is studied by @Schulz2007 who relates economic growth to material consumption.
- *To understand or model relationships in the urban environment.* At a fairly simple level, this could mean finding relationships between  the use of different resources, for example the examination of the links between urban energy and water consumption [@Kenway2013]. Geographical dependencies can also be studied; for example @Barles2009 reveals Paris' reliance on surrounding regions for material provisions and waste management. @Bristow2013 identifies the relationship between Toronto's energy consumption (i.e. a flow) and its energy stocks (with the purposes of assessing the city's ability to cope with supply failure or other shocks to the energy stocks). Moving to a greater level of sophistication, a number of studies, including @Zhang2010 and @Liu2011a have studied how resources flow between a city's different economic sectors, and thus determine the extent to which sectors are interdependent; studies of this sort could enable planners to decide how sectors could best work together to use a city's resources more efficiently.
<!--
  A more novel use of UM is to "develop mathematical models of processes within the urban metabolism" [@Kennedy2011, p.1970][^process-defn]

[^process-defn]: Note that 'process' here refers generally to operations within an urban environment, rather than resource management technologies specifically.
-->

To summarize, UM is an important idea, which provides a framework to examine resource consumption alongside issues of urban sustainability [@NextCity2014]. Specifically, they enable comparisons of resource consumption and output; facilitate the calculation of greenhouse gas emissions and similar important measures; identify relationships between patterns of resources use, challenges, and socioeconomic indicators; and explore relationships at work within urban boundaries. In these ways, UM studies can provide insight on how to maintain of urbanisation's socioeconomic benefits while limiting environmental harm.

### The place of processes in urban metabolism modelling {#sec:procs-in-UM}

UM has contributed many useful insights, but of most interest to this thesis is the fourth type of UM study listed above -- the understanding and modelling of relationships in the urban environment -- since this work is concerned with how different mixes of resource management processes (i.e. activities occurring within an urban boundary) can affect overall metabolic flows. A key question then, is to what extent have UM studies sought to understand the role of resource management processes on an area's metabolic flows? This section considers this by taking a closer look at how resource management *processes* fit within urban resource management as a whole, and considering how the UM literature has understood this. 

Analysis of a city can focus on the different parts of an urban metabolic
system, each of which work together in a hierarchical framework defined especially for this thesis (Figure \ref{fig:metab}). At the 'bottom' lie end consumers, namely the homes, business, industry and transport that exert demands for final energy and water consumption, as well as generating wastes. At the 'top' are the aggregate exchanges between a city and the surrounding environment: both the import of natural resources required to meet consumer demand, and the export of a city's wastes and effluents. In the 'middle' is a network of processes that link the top and the bottom, converting natural resources to demands, as well as treating and managing locally generated wastes. Typically, urban metabolism studies seek to quantify the overall metabolic flows at the top, and to locate the origins of these flows at their point of demand at the bottom. 

This section extends published arguments that advocate giving greater attention to the middle of the system, in order to show how the mix of processes used to meet demand at the bottom will affect overall metabolic inputs and outputs at the top.

\begin{figure}
	\centering
	\begin{spacing}{1.0}
	\sffamily
	\resizebox{\columnwidth}{!}{\input{04_database/metab-hierarchy.pdf_tex}}
	\end{spacing}
	\caption{Three components to an urban metabolism system with example resource flows adapted from the hypothetical city in \cite{Wolman1965}.}
	\label{fig:metab}
\end{figure}

#### "Top-down"

According to @Chrysoulakis2014, most urban metabolism studies take a top-down approach. Their aim is to quantify the impacts of an entire urban area's consumption and waste generation [@Sahely2003]. Typically studies do this using data aggregated at the city scale (i.e. it cannot be traced back to particular locations or activities) [@Chrysoulakis2014]. Several methods are described in @Sahely2003. One example is Wolman's seminal study which derived a hypothetical city's resource flows from national rates of consumption (water, food and fuel) and generation (sewage, waste and air pollutants).

A more sophisticated approach might adjust these values; for example, a city's food intake could be calculated by adjusting the national average food consumption according to a city's grocery bill expenditure (as suggested by Sahely et al.). Ideally though, data would be supplied directly from appropriate organisations: water consumption data from the public or private providers; electricity consumption data from market operators; and waste data from municipal authorities. Once collected, the data can be used to analyse trends and make inter-city comparisons, to reveal how variables (such as climate, urban form, economic activity etc.) correlate with overall metabolic flows, as exemplified by @Kennedy2015's study of megacities.

Top-down studies can inform policy, as seen in @Liang2011 who use government statistics in a top-down metabolism study of Suzhou, China. Their findings lead to precise proposals to achieve decarbonization (in this case focussing CO$_2$ mitigation strategies on vehicle pollution because trends indicate that the city is on course for low-carbon development in other sectors).

#### "Bottom-up"

An alternative approach is to build up a picture of a city's metabolism from the bottom up, by quantifying resource flows at small scales and then aggregating these over the region of study [@Chrysoulakis2009]. For example, @Kellett2013 describe a method to quantify a neighbourhood's CO$_2$ emissions by modelling the CO$_2$ flows in the neighbourhood's buildings, transport, humans, and vegetation components. For instance, to calculate the total emissions attributable to buildings, first building types are determined from architectural features (found from fieldwork, databases, and LiDAR information), enabling researchers to know the number of each building type of building in the neighbourhood; next the emissions for each type of building (such as an apartment) are estimated using a model which takes into account a building's occupancy, age and HVAC equipment. Finally, emissions for each building type can be multiplied by the prevalence of each building type to calculate total emissions.

Another bottom-up approach comes out of the Vulcan Project which measures CO$_2$ emissions at fine spatial and temporal resolutions, using networks of ground and air remote sensing technologies [@Asefi-Najafabady2014]. @Gurney2012 present results for the city of Indianapolis to understand the origins of its emissions, enabling decision makers to implement mitigation strategies, which are both effective and low cost.

Bottom-up methods often depend on high-tech tools including: sensor technology to measure energy, water, and pollutant fluxes; GIS and remote sensing devices to collect information on land-use, thermal radiance and rainfall; and advanced numerical modelling to simulate resource fluxes [@Chrysoulakis2009]. An alternative low-tech approach is to survey residents of a city about their resource use habits; for instance, deriving information on urban water flows by asking householders about their typical dishwasher loads and shower durations [@Eberlein2014].

#### Merits, limitations, and a complementary approach

Top-down approaches are methodologically simple, but they do not easily nurture an appreciation of the ultimate causes of emissions or other environmental impacts [@Kellett2013], and are thus unsuited to predicting how metabolic flows might change under different scenarios, hence the power of bottom-up methods which can be used to test scenarios and policies. Kellett et al. exemplify this in their neighbourhood emissions model by altering land-use, building efficiency, transport fuels, and consumer behaviour to observe how overall emissions change.

@Zhang2013 traces the evolution of the UM concept and concludes that more attention should be paid to the *middle* of a system (figure \ref{fig:zhang}). Starting with Wolman's seminal study, UM understood a city to be a linear system into and out of which resources flowed. On this view, sustainability efforts are focussed on minimising the inputs and outputs. This understanding was refined by @Girardet1990, who suggested that in addition to minimising resource inputs (e.g. by using solar energy and more efficient energy processes such as CHP), cities should be adopting circular metabolisms, whereby outputs could be reused as inputs through waste recycling (as discussed in Section \ref{sec:UM-theory}). Both of these understandings are 'black-box' representations, in which there is no consideration of mechanisms at work within a city, hence @Zhang2013 notes that both bottom-up and top-down approaches fail to consider the mechanisms within the urban system which determine its behaviour -- or as this thesis denotes it -- the *middle* of the system. The top-down approaches are well suited to identify the scale of metabolic problems, and the bottom-up approaches contribute understanding on the ultimate causes of problematic flows, but appreciation of the middle will add to the insights of bottom-up studies by revealing the role of internal activities and functions between the top and the bottom of an urban system.

To address this gap in UM research, @Zhang2009 proposed research into how resources move around inside the UM system. Specifically Zhang et al.'s work (and its offspring, such as @Liu2011a) considers the economic sectors (nodes) within a system, and the degree to which they are dependent upon one another by resource flows (linked). Such information is useful to help identify potential problems for an urban system (e.g. identifying where sectors are competing for a limited resource). Thus Zhang argues research should prioritise quantitative analysis of an urban system's components, which models urban systems as a network of linked nodes. This representation of a system provides a framework to understand how fluxes circulate, thus enabling researchers to test how management interventions and other scenarios will change the distribution of resources between economic sectors.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.5\textwidth]{02_lit-review/zhang-um-developments.jpg} 
	\caption{Developments in ways to think about urban metabolism. Figure copied directly from \citet{Zhang2013}.} \label{fig:zhang}
\end{figure}


#### A comprehensive understanding of the 'middle' {#sec:understand-the-middle}

If these recommendations are to be realised, the urban metabolism field should seek a comprehensive understanding of what constitutes the middle to enable modelling to take place; i.e. identifying and describing the nodes and the links within metabolic networks. In Zhang's paper, the middle of the system is understood to be a set of economic sectors (represented by nodes), which consume and produce resources that transfer to between sectors (along links), as well as importing and exporting them across the urban boundary. This conceptual model has led Zhang and others to conduct UM studies which investigate the effect of the 'middle' of the system, using ecological network analysis (ENA) to investigate the extent to which different economic sectors are dependent on each other, and the implications for a city's overall metabolic flows (e.g. @Zhang2010 and @Liu2011a)[^ena-studies].

[^ena-studies]: These studies are discussed in more detail in Section \ref{sec:grey-box-metrics}.

However, to Zhang's *economic sector* perspective of a UM system's middle, this thesis will propose an *engineered-system* perspective. On this view, the nodes and links would correspond to resource management processes (e.g. powerplants, water treatment units, and pipe networks) and resource flows, respectively (as per part (B) of Figure \ref{fig:metab}).  Studying nodes and links could suggest how a city's mix of processes could meet resource demand in cheaper and greener ways, beyond demand-side management. As a case in point, consider how a city meets domestic heating demand: bottom-up studies could explore how measures such as thermal insulation and lower thermostat settings reduce fuel requirements at the top. But studying the middle would explore how investment in processes could reduce fuel usage, for example showing how how heat demand could be met by waste heat from power generation rather than gas boilers. This kind of approach can be extended to study how a city's whole process mix, layout and scheduling can be optimised to maximise synergies, and thereby minimise a city's overall resource consumption and waste generation. Indeed, informing optimisation strategies to improve UM is highlighted by @Zhang2013 as an area of future UM research.
<!--
Other authors have noted that there is a "poor mechanistic underlying urban metabolism" theory, thus providing a roadblock to finding ways for resource to be used more efficiently [TODO: cite Fernandex-Mena et al.].
-->


<!--
http://pubs.acs.org/doi/pdf/10.1021/acs.est.5b03060

In particular, a systems engineering approach should be introduced to unify and standardize the methods of categorizing and quantifying data; to establish databases that will support investigation, analysis, and evaluation; to obtain multiscale data to meet the database requirements of such analyses; to improve our understanding of urban metabolic principles and scale effects to support management and policy development and meet the requirements of different stakeholders; to integrate the insights from different fields of research; and to design research that will provide solutions for specific social policy problems, which will guide industrial development and that will promote restoration of the urban ecological balance.
-->

### Summary

In summary, UM can be considered as the study of how a cities flows, forms and functions relate. While there is work to be done to study each of these areas (both individually, and how they work together), the arguments of @Zhang2013 should be extended to argue for research into how a city's processes work together as an engineered system. This conceptualisation then becomes the basis for this thesis, from which it becomes possible to formulate an optimisation model which can take advantage of synergies between different resource management infrastructure), and so contribute the answering the research question of this thesis.

<!--
In addition to summarising the evolution of UM research, @Zhang's also points out that 
identifies four ways the UM concept can be used, each building on the previous. First, there is UM theory (which has been discussed above in terms of linear, circular, and network representations of UM). Second, UM can be used for accounting and assessment, to quantify stocks and flows (perhaps using them to calculate performance indicators). Third, ideas of UM can be used to generate simulation models, used to study dynamics, perhaps to see how a metabolism might change under various scenarios. Finally, UM ideas can be used to inform optimization and regulation strategies, which seeks to improve a metabolism in relation to some objective through management interventions in the nodes and paths of a metabolic network. It is this last area which @Zhang identifies as having the greatest need for future research. 

[TODO: can this content be inserted earlier in the lit review?]

Our introduction to UM thus far has been focussed on the resource flows into, out of and within urban areas. However, other studies attempt to integrate such studies of *flows* with the studies of cities spatial and material *forms* and/or their socioeconomic *functions*. 
- (urban political ecology, the central focus of https://www.bartlett.ucl.ac.uk/dpu/latest/publications/dpu-working-papers/WP168.pdf), 
- relationships with hinterlands and wider/global markets
- form ("such as distribution and density of housing, infrastructure etc.) influence MFA... who has access and who benefits from them..."
  	- @Barles2010a
- socioeconomic functions: @Newmann1999

- or they only focus on one resource, they are not intersectoral. Indeed, as @Fernandez-Mena2016 states the issue, UM models [TODO: note this was originally written in relation to nutrient recycling loops]
- Another author who has independently come to a similar conclusion is [TODO: citation].

> "... may seldom consider a whole mass balance since some flows are sometimes not quantified and do not always follow elements  along their whole cycle... The poor mechanistic basis underlying urban metabolism may prevent their use for exploring and simulating options for more efficient recycling loops within social ecological systems."
-->

## The role of modelling in urban metabolism

<!--
Jargon:

- Sets
- Parameters
- Constraints
- Objective (Cons and Obj are the mathematical relationships: equations, inequalities, logical relationships)
- Variables

Techniques:

- Linear, nonlinear, heuristics (e.g. GAs) etc.
- Map out linear/non-linear problems, and the solution approaches
- There should be a brief outline of this (even if it's just a list of definitions) so the when they are referred to in the literature review, the reader knows what we are talking about.
-->

The literature review above surveyed UM research to outline the different ways UM contributed to understanding resource flows in cities. In doing so, it highlighted the need for better understanding of the 'inside' of a UM system generally, and the engineered system specifically -- in the case of this thesis, the role of resource management processes in affecting the overall flows of energy, water, and waste into and out of a city. This section seeks to move this idea forward by considering the role that modelling can play in UM by systematically researching the current state of affairs of UM modelling. Before this however, this section first pauses to introduce the idea of modelling generally. 

### An introduction to modelling {#sec:modelling-intro}

Whenever models are used, it is important to justify their use, but it is especially important here specifically, when introducing a new model to the urban metabolism field. A model can be defined as:

> "A simplified or idealized description of conception of a particular system, situation, or process, often in mathematical terms, that is put forward as a basis for theoretical or empirical understanding, or for calculations, predictions, etc..."

\attrib{\citet{OED-model2016}, definition 8a}

Note in this definition, the explicit reference to a 'system'. It is precisely the complexity of a system -- a concept introduced back in Chapter 1 -- with its various interactions and moving parts, which warrants simplified, formalised descriptions in the form of models to aid understanding, calculation, and prediction. The specific benefits of modelling are highlighted by @Williams1999:

1. The act of model building itself will reveal relationships that were previously unapparent;
2. The results may reveal courses of action which were otherwise uninvestigated;
3. One can experiment on a model in a way that may be impractical or unethical for a real system\footnote{This idea is the premise of the sketch from \emph{That Mitchell and Webb Look} quoted at the beginning of the chapter.}.

However, modelling is not without its critics, and it is right to address their objections if this thesis is to propose, formulate and apply a new model. Some only see crude reductionism in the way that mathematical programming seeks to quantify something, resting decisions on the numerical value of an equation. @Williams1999 points out that in fact all decisions will make quantitative evaluations implicitly, if not explicitly, and suggests modelling is at least an honest and scientific way to formalise the quantitative component of decision making. Others point out that inaccuracies in a model's coefficient values will propagate to inaccurate results. Williams responds by showing how models can be tested for a range of parameter values (to reflect uncertainty), for example establishing the ranges for which parameters can change with predictable effects on the values of model outputs. Models are therefore not a 'magic bullet', but nonetheless they are still important as "one of a number of tools for decision making" [@Williams1999, p5] to understand systems, test their performance, and identify ways to improve the system.

### Types of models {#sec:model-types}

Some of the different types of models that exist are summarised in Figure \ref{fig:models} (which is based on the content of @Williams1999 (Chapter 1). The first categorisation divides models into those that are *concrete* or *abstract*. The former type exist physically, for example, a scaled-down construction of an aeroplane or laboratory-scale version of some resource management process). The latter type exist as conceptualised representations of a system. Abstract models can be purely *conceptual* (sometimes called 'descriptive'). These models graphically, visually or diagramatically represent a system so as to provide an explanatory which helps people understand the workings of the real system. A classic example is the nitrogen cycle diagram that many learn in school, which uses arrows to show how nitrogen transfers between the atmosphere, ground, and plants. This representation of the cycle does not include any mathematical content, but it does visualise how plants, bacteria, the atmosphere, and other components convert nitrogen [@BBC2014].

\begin{figure}
	\centering
	\begin{spacing}{1.0}
	\sffamily
	\resizebox{\columnwidth}{!}{\input{05_model-development/models.pdf_tex}}
	\end{spacing}
	\caption{A summary of different types of models, based on \citet[Chapter 1]{Williams1999}.}
	\label{fig:models}
\end{figure}

Abstract models can also be *mathematical*. These use mathematical relationships to describe a system. One particular type of mathematical models are statistical models. In these, the statistical properties of a set of sample data (for example, the relationships between the age and height of 50 children selected randomly from a school) are used to predict the characteristics of a larger group (for example, the height of any student in the school, given the age). Other types of mathematical models include simulation models, and optimisation models (the latter is also known as mathematical programming, and was briefly introduced in Section \ref{sec:systems-optimisation}). Both of these use equations, inequalities and logical dependencies to represent the workings of a system.  Simulation models predict how a system will perform under a given set of conditions. An example could be the length of a traffic queue given a particular system of traffic signals [@Grether2012]. Optimization models compute the conditions under which a system will perform achieve the objective defined by the modeller). An example would be to compute when traffic signal changes should be timed in order to minimise traffic congestion [@Osorio2008].

The equations of simulation and optimisation models are formed of parameters, which are fixed values representing unchanging conditions of the system (such as the length of a given road); and variables, which are at liberty to to change (such as the length of time for a signal to display a green light). In simulation models, the variable values are selected by the modeller, who wants to investigate the effect of their changes; whereas for optimisation models, the reverse is true -- the desired outcome is specified first, and the variables to achieve this are chosen by mathematical algorithms. Often, the formulation of a mathematical model (i.e. the equations, parameters, and variables) a descriptive model: what the model visualises, the model can formalise mathematically. A descriptive model has already in fact been proposed in this chapter, namely the hierarchical framework of Figure \ref{fig:metab}. The object of modelling in this work is to optimise the system -- the process mix and their operation schedule -- for any given set of demands and available resources.

### An overview of urban metabolism models

Each of the model types above can be found in the UM literature. Indeed, the idea of urban metabolism is itself a descriptive model, i.e. the concept of 'metabolism' has inherent to it the fact that resource flows relate to an entity's form and function. To show where this thesis can fit within the UM modelling landscape, this section systematically reviews the literature found by exploring the Scopus database using the search term `urban metabolism AND model OR modelling` (excluding irrelevant subject areas such as medicine). This search returned 239 results which were manually reduced to 108 after removing articles which were  inaccessible, not published in English, only tangentially related to UM, or did not satisfy the definitions of 'model' as described above. Looking further at the remaining results, each paper was classified according to three three categories: the **type** of model (according to the definitions given in Section \ref{sec:model-types}, above); the model's **focus**, which refers to the component(s) of urban metabolism studied by the model; and **level** of detail to which a system is modelled. The following three subsections summarise the variety of models to be found in UM.

\begin{description}

\item [Type] As explained above, the idea of UM itself is a \textbf{conceptual} model, which appropriates the language and ideas of real biological systems to explain urban resource flows. The concept has grown from Wolman's first study which considered simply the flows of resources, and the challenges of their public management. One such development of the concept is that of \citet{Newman1999a}, who proposed the 'Extended Metabolism Model of the City' (p.220), which adds 'livability' to encourage researchers to consider how resource flows relate health, incomes, housing stock, and other aspects of urban living. Other extensions of the UM conceptual model are highlighted by \citet{Zhang2013}, and include the work of \citet{Girardet1990}, who incorporates the recycling of resource outputs as inputs, and \citet{Zhang2009b}, who asks modellers to consider how resources flow between sectors within the urban boundary \ref{sec:procs-in-UM}.

Moving beyond the conceptual models, the various types of mathematical models have been developed to understand urban metabolism. An example of a \textbf{statistical} model is that of \citet{Liang2014} who find a relationship between the level of a city's nighttime lighting (as measured by satellite observations) and the city's steel stock, making it possible to predict the latter from the former. \citet{Kellett2013} provide an example of a \textbf{simulation} model, in which a city's emissions are quantified from equations which calculate the contributions from building, transport, human, and vegetation sources. Finally, an \textbf{optimisation} model is put forward by \citet{Pedersen2013} who `evolve' optimised city designs by using heuristics to choose new building envelopes, road networks, public spaces etc. according to the metabolic capabilities and limitations.

\item [Focus] UM models have different foci, which are considered here under two sub-characteristics: models that try to understand more about the resource flows of a city, and models which study non-resource components of UM. Resource-focussed models can study just a \textbf{single resource}, as in the case of \citet{Zeng2014}, who formulate mathematical models of water treatment technologies and end uses to simulate the quantity of water and wastewater flows between them. Other models focus on \textbf{multiple resources}, such as \citet{Liang2011}, who evaluate how various energy and material flows (including coal, water, biomass and pollutants) change under proposed policies. (Sometime, these models consider multiple resources but they are \textbf{umbrellered} under a single value system; examples include \citet{Huang2005} who quantify various flows including solar energy, rain and fossil fuels in units of emergy\footnote{Emergy is outlined in greater detail in Section \ref{sec:black-box-metrics}.}. Non-resource-focussed models might look at \textbf{urban form}, such as the steel-stock accounting model of \citet{Liang2014} (mentioned above); \textbf{socioeconomics}, such as \citet{Newman1999a}, (again, mentioned above); and the \textbf{environment}, such as \citet{Huang2005} who predicts an area's greenhouse gas emissions according to the construction characteristics of houses in the areas.

\item [Level] The third way UM models are classified here is according to the level at which they represent components of an urban system (either conceptually or mathematically), which this thesis defines from low to high. \textbf{Low-level} models capture the most detail, considering those models which quantify resource flows occurring among an urban area's resource management processes and/or its points of demand. One example is the model of \cite{Zeng2014} who quantify the water flows between different sectors (domestic, industrial etc.) and systems (supply, treatment etc.). Alternatively, low-level models could include those which use equations for bottom-up mathematical descriptions of system components (e.g. \citet{Kellett2013}, described earlier).

At the next level of detail, \textbf{medium-level} models include those in which conceptual or mathematical relationships are defined for a UM system's organisational sectors and/or socioeconomic functions. For example, \citet{Zhang2010a} use ecological network analysis\footnote{Ecological network analysis (ENA) is described in detail in Section \ref{sec:black-box-metrics}.} to model the resource-interdependence of 17 economic sectors to each other. In other medium-level models, \citet{Fung2005} relates an area's institutional activities to its sustainability, and \citet{Huang2005} relates energy flows to urban development. Finally, \textbf{high-level} models capture system dynamics in their broadest sense. For example, using simple ratios to relating society size and transport volumes \citep{Fischer-Kowalski2004}, or relating a long-term trends for energy demand to on the upstream energy \citep{Baynes2012a}.

\end{description}

Each of the 108 papers captured in the search and filtering of the UM modelling literature are plotted as a point on Figure \ref{fig:UM-model-lit}. The point is coloured according to the model type, while its focus and level is represented by its location. The models cited above are labelled on the plot. Examining the plot, it is possible note features and gaps in the UM modelling landscape, such as the dominance of simulation models and models which focus on how an area uses resources. However, when it comes to optimisation models, there is only one (which considers urban form). This reveals a gap for the contribution of this thesis, namely a model whose purpose is to consider the optimisation of energy, water and waste flows (i.e. multiple resources) between resource management processes (i.e. low level).

```{r metab-lit-review, results="asis"}
###--------------------------------------------------
## PREPROCESSING
### From lit-metab-modelling.csv, we used R to remove rows with states!="cut")
### From lit-keep-maybe.csv, we summarised the attributes for each paper, and identified more papers to cut
### We are left with lit-final-cut.csv, which is used below
###--------------------------------------------------

###--------------------------------------------------
### Set up the database for cluster analysis
###--------------------------------------------------


#setwd("02_lit-review")
setwd(getwd())
library(dplyr)

### Load in literature titles and attributes, removing the remaining papers marked 'CUT'
lit_draft_cut <- read.csv("02_lit-review/lit-final-cut-thesis.csv")
lit_final_cut <- filter(lit_draft_cut, type!="CUT")

## TODO: merge some of the model use groups together for clarity (e.g. include 'other' grouping)

## Only keep variables relevant for our cluster analysis
lit_final_cut <- select(lit_final_cut,
			c(Title, type, method, techniques.broad, techniques, techniques.IO, techniques.other, focus.broad.cat, focus.broad, focus, focus.multiple, focus.other, use, use.other, text.label))

```


```{r metab-lit-review-plot, fig.height=8, fig.width=6, fig.cap="An overview of the UM modelling literature. Jitter (normally distributed random noise) has been applied to the points to prevent them overlapping one another. \\label{fig:UM-model-lit}"} 

###--------------------------------------------------
### Select and order attributes for ordinal data
### E.g. for plotting, it is helpful for "Low-level", "Medium-level", and "High-level" to appear in this order
###--------------------------------------------------

## Select attributes to be plotted in the analysis
lit_main_cats <- select(lit_final_cut, c(type, method, techniques.broad, techniques, focus.broad.cat, focus.broad, use, text.label))

## Order attributes for ordinal data (e.g. for plotting, it is helpful for "Low-level", "Medium-level", and "High-level" to appear in this order)
lit_main_cats <- transform(lit_main_cats,
			   type=factor(type,
			     levels=c("conceptual", "mathematical", "various"),
			     ordered=TRUE),
			   techniques.broad=factor(techniques.broad,
			     levels=c("low", "medium", "high"),
			     ordered=TRUE),
			   techniques=factor(techniques,
			     levels=c("Bottom-up mathematical description", "ENA", "integrated", "LCA", "mass and/or energy balance", "mathematical representation of subsystems", "other", "ratios", "regression", "relate actors", "relate various", "various")),
			   focus.broad.cat=factor(focus.broad.cat,
			     levels=c("resource", "other", "methodology"),
			     ordered=TRUE),
			   focus.broad=factor(focus.broad,
			     levels=c("single resource", "multiple resources", "umbrellered", "form", "socioeconomic", "environment", "methodology"),
			     ordered=TRUE),
			   use=factor(use,
			     levels=c("accounting", "forecasting", "other", "scenario analysis", "strategic planning", "system understanding/improvements", "theory")))

###--------------------------------------------------
### Plot results to identify clusters
###--------------------------------------------------

## Remove NA (row 46)
lit_main_cats <- lit_main_cats[-46, ]

## Add a column to distinguish resource and non-resource focus models
lit_main_cats$focus_category <- "Non-resource"
lit_main_cats[lit_main_cats$focus.broad %in% c("single resource", "multiple resources", "umbrellered"), "focus_category"] <- "Resource"


plot_cluster <- ggplot(lit_main_cats, aes(x=techniques.broad, y=focus.broad)) +
  geom_jitter(aes(colour=factor(method)), width=0.1, height=0.1) +
  geom_text(aes(label=text.label, colour=factor(method)), size = 2) +
  facet_wrap(~focus_category, ncol=1, scales="free_y") +
  theme_bw() +
  theme(legend.position="bottom",
	legend.direction="vertical") +
  guides(col=guide_legend(ncol=2)) +
  xlab("Level") +
  ylab("Focus") +
  scale_colour_discrete(name="Type")
plot_cluster
```

## Review of resource managagement optimisation modelling {#sec:rev-um-opt-models}

So far, this chapter has introduced UM as a research area that can support urban sustainability measures, and has shown that modelling is one means by which this can happen. This thesis will add to UM modelling capabilities a model which can optimise the simultaneous design of urban energy, water, and waste systems, so as to take advantage of intersectoral synergies, and thus improve an area's metabolism. To assist that cause, this section reviews a number of 'resource management optimisation models'[^ROM]. This has two purposes: first, to confirm the need for a model which can simultaneously optimise multiple resource management systems at the urban scale (thus complementing the findings above that the UM modelling literature includes no such models); and second, to suggest possible methodologies which can be adapted in this thesis.

[^ROM]: Note that 'resource management optimisation modelling' is not a subject area which has a formal definition (unlike say, 'urban energy systems modelling' (which is formally defined in @Keirstead2012b), rather it is used here to refer generally to optimisation models which are used to assist system managers improve the management of an energy or material resource for which they are responsible, and can incorporate everything from the efficient production of a single resource in some component of a plant, up to global strategies to manage.

Each the model types introduced in Section \ref{sec:model-types} can be found in resource optimisation modelling. Concrete models are often used to find the optimal parameters and conditions for running some process (e.g. anaerobic digestion) -- these are in the form of laboratory experiments or scaled-down versions of a plant. (Often, these concrete models are coupled with statistical techniques to help find the most optimal conditions under which to operate a process.) At other times, the processes under study are represented mathematically. In simulations, variables can be changed, to investigate the effect on resource yield or some other objective related to resource management. In optimisation modelling, planners and policy makers are helped to determine the design and operation of the infrastructure which extracts, refines, converts, and transports resources. Often these optimisation models take the form of a 'minimum cost network flow' problems [@Williams1999, p81], in which a set of equations are solved to select a mix, layout, and operation schedule for resource management infrastructure to meet some objective, e.g. to maximise profit or minimise emissions.

### An introduction to the literature

The most famous resource management models are arguably the models used to help design energy systems at the national scale, such as MARKAL which attempts to plan an energy system, considering resource availability, infrastructural capabilities, technological possibilities, and taxation and policy regimes [@UCL2015]. It is used by governments, NGOs, and researchers around the world to help propose and plan energy strategies [@USEPA2015].

Of most interest to this thesis however, are optimisation models formulated for the urban scale, and in particular, those that consider energy, water, and waste systems (which are the sectors under study in this thesis). One example of an urban-scale resource management optimisation model is the urban energy systems model of @Keirstead2012. In one application, the model evaluates energy supply for a UK eco-town, focussing on the potential benefits of biomass-based systems. A set of linear equations represent the resource quantities (e.g. biomass, heat, electricity, etc.) supplied to and removed from zones within the town at any given time. Parameters represent the zonal resource demands, resource availability, and technology behaviour. Variables represent whether a technology is present in a given zone, and at what rate is operates, as well as a schedule of resource movements within and without the city.

Optimisation models also are used to help plan urban water supply networks. For example @Zanganeh2010's model optimises the performance of an area's existing water network, choosing reservoir heights and pump sizes. @Lejano2006 applies optimisation modelling to a network design, starting with the spatial distribution of customer demands, it selects appropriate locations for the pipes. Some water optimisation models also seek to minimise freshwater consumption through employing water reclamation processes, water saving technologies -- examples of these can be found in @Lim2010 and @Makropoulos2008. Finally, there are a number of waste management planning optimisation models such as @Li2006. These models allocate waste flows from their point of generation to various management facilities, to inform longterm decisions. (i.e. investment choices and capacity requirements).
<!--
@Keedwell2006 (e.g. decision variables include water pipe dimensions)
-->

### An overview of the literature {#sec:optim-model-overview}

The energy, water and waste models introduced above vary in their formulations, according to their different purposes. Moving from these specific examples, to consider the resource optimisation models more generally, a quasi-systematic literature review can help to identify trends and patterns in how model formulations vary according to purpose. This will reveal gaps in the literature which will be met by this thesis, as well as precedent methods which can inspire the formulation of the model in this thesis. The first stage of the review used the Scopus tool to search for relevant literature, using the search term `energy AND water AND waste AND optimization model` (excluding irrelevant subject areas such as psychology).

```{r model-lit-review-load, results="asis"}

## Packages required by our analysis of the literature
library(tm)
library(dplyr)
library(ggplot2)
library(reshape2)

## Load in all titles
lit <- read.csv("02_lit-review/lit-resource-modelling.csv")
titles <- as.character(lit$Title) # The unedited paper titles

## Save number of files in original list (for output into document)
uncut_list_size <- dim(lit)[1]
uncut_list_size <- prettyNum(uncut_list_size, big.mark=",") # Insert a 1,000s comma separator
```

```{r model-lit-review-tm, results="asis"}

## Merge titles into single block of text
text_full <- paste(titles, collapse=" ")

## Edit the text for mining
text_source <- VectorSource(text_full)
corpus <- Corpus(text_source)
corpus <- tm_map(corpus, content_transformer(tolower))
corpus <- tm_map(corpus, removePunctuation)
corpus <- tm_map(corpus, stripWhitespace)
corpus <- tm_map(corpus, removeWords, stopwords("english"))

## Create the document-term matrix, and count word frequency
dtm <- DocumentTermMatrix(corpus)
dtm2 <- as.matrix(dtm)
frequency <- colSums(dtm2)
frequency <- sort(frequency, decreasing=TRUE)

## Create dataframe of word frequency
words <- names(frequency)
freq <- as.data.frame(frequency)$frequency
word_freq <- data.frame(words, freq) # 11,967 unique words in total

## Save word-frequency list for manual editing
write.csv(word_freq, "02_lit-review/words-pre-cut.csv", row.names=FALSE)
```

```{r model-lit-review-listReduction, results="asis"}

###--------------------------------------------------
### Manually reduce the list of words (removing those which don't refer to resources, e.g. 'network')
##### Original list: words-pre-cut.csv (11,967 unique words)
##### Reduced list: words-post-cut.csv (366 unique words)
### Manually categorise remaining words (e.g. "electricity" --> "energy"), and store in word-cats.csv
### Apply word-frequency analysis to identify:
##### (A) the number of word matches for each title
##### (B) the number of category matches for each title
### Plot and save results
###--------------------------------------------------

## Load manually-reduced database of word frequencies
word_freq_cut <- read.csv("02_lit-review/words-post-cut.csv")

```
[^unique-words]: This list of resources and their categories is supplied at [TODO: add URL].

```{r model-lit-review-categs, results="asis"}

## Load in categorisation of words
word_cats <- read.csv("02_lit-review/word-cats.csv") ## TODO: Remove the 'nonresource category'
```

```{r model-lit-review-categMatches, results="asis"}

## List of words to match
text_cut <- read.csv("02_lit-review/text_cut.csv")$word

## Set up vectors to store the results of the word-frequency analysis
T <- length(titles)
word_matches <- length(T)
cat_matches <- length(T)
cat_matches_list <- length(T)
optim <- rep(1, T)

## Loop over all titles, to identify the number of matching words
for(i in 1:T){

  ## Convert title into a vector where each word is a unique element
  title <- titles[i]
  title <- tolower(title) # Convert to lowercase
  title <- gsub("[[:punct:]]", " ", title) # Replace punctuation with spaces
  title <- unlist(strsplit(title, split=" ")) # Convert to vector

  ## For each title, count the number of words matching those in our list
  intersections <- intersect(title, text_cut)
  word_matches[i] <- length(intersections) ## a vector of how many matching words

  ## For each title, identify the number of unique categories containing the matched words
  categs <- filter(word_cats, words %in% intersections)

  ## For each title, count the number of unique categories containing the matched words
  cat_matches[i] <- length(unique(categs$category))

  ## For each title, list the unique categories containing the matched words
  categs_list <- as.character(sort(unique(categs$category)))
  categs_list <- paste(categs_list, sep="", collapse=", ")
  cat_matches_list[i] <- categs_list

  ## Identify the titles with 'optimi[s/z]ation', or similar
  optims <- match(c("optimization",
	  	 "optimisation",
	  	 "optimized",
	  	 "optimised",
	  	 "optimal"), title)

  if(all(is.na(optims)) == TRUE){
    optim[i] <- 0
  }

}

## Store results for each title in dataframe
title_matches <- data.frame(titles, word_matches, cat_matches, cat_matches_list, optim)
```

```{r model-lit-review-plot, results="asis"}
## Save titles and category matches (in original order)
write.csv(title_matches, "02_lit-review/title-matches-original-order.csv", row.names=FALSE)
```

```{r model-lit-review-optimReduction, results="asis"}

## As above, but just the titles containing 'optimization' and similar words
title_matches_optim <- filter(title_matches, optim==1)
write.csv(title_matches_optim, "02_lit-review/title-matches-optim-original-order.csv", row.names=FALSE)

## Save titles and category matches (sorted according to the frequency of category matches)
title_matches <- arrange(title_matches, desc(cat_matches))
write.csv(title_matches, "02_lit-review/title-matches.csv", row.names=FALSE)
```

```{r model-lit-review-categMatchFreq, results="asis"}

###--------------------------------------------------
### Make dot plot of category combinations in the literature
###--------------------------------------------------

## Get frequency of each combination of categories
combo_freqs <- data.frame(count(title_matches, cat_matches_list))
names(combo_freqs) <- c("Combinations", "CatFreq")

## Get frequency of 'optimization' within each category
optim_freqs <- title_matches %>% group_by(cat_matches_list) %>% summarize(sum(optim))
optim_freqs <- data.frame(optim_freqs)
names(optim_freqs) <- c("Combinations", "OptimFreq")

combo_freqs <- merge(combo_freqs, optim_freqs)

## Incorporate the number of categories for each combination (so plot can be faceted according to this)
tmp <- title_matches[!duplicated(title_matches$cat_matches_list), ]
tmp <- select(tmp, c(cat_matches_list, cat_matches))
names(tmp) <- c("Combinations", "n")
combo_freqs <- merge(combo_freqs, tmp)

## Create a column of titles (to be printed as facet_wrap strip titles)
combo_freqs$NumCats <- combo_freqs$n
combo_freqs[combo_freqs$n==0, ]$NumCats <- "Zero category matches"
combo_freqs[combo_freqs$n==1, ]$NumCats <- "One category match"
combo_freqs[combo_freqs$n==2, ]$NumCats <- "Two category matches"
combo_freqs[combo_freqs$n==3, ]$NumCats <- "Three category matches"
combo_freqs[combo_freqs$n==4, ]$NumCats <- "Four category matches"
combo_freqs[combo_freqs$n==5, ]$NumCats <- "Five category matches"

## Sort so number of categories will be faceted in ascending order
combo_freqs$NumCats <- factor(combo_freqs$NumCats,
			  levels= combo_freqs$NumCats[order(combo_freqs$n)])

## Sort so combination frequencies will be plotted in ascending order
combo_freqs$Combinations <- factor(combo_freqs$Combinations,
			  levels= combo_freqs$Combinations[order(combo_freqs$CatFreq)])

## Reshape so that CatFreq and OptimFreq can both be plotted as points
combo_freqs <- select(combo_freqs, -c(n))
combo_freqs <- melt(combo_freqs, id.vars=c("Combinations", "NumCats"), value.name="Frequency")
```

```{r model-lit-review-reduction, results="asis"}

###--------------------------------------------------
### POST-PROCESSING
### Copy title-matches-optim-original-order.csv --> title-matches-optim-original-order-edit.csv,
### (A) manually identify irrelevent papers with 'CUT'
### (B) assign a scale (e.g. 'domestic', 'regional' etc.) to each model
### (C) assign a level of integration ('none', 'integrated', or 'highly integrated') to each model
### This is so we can analyse the content of the remaining papers
###--------------------------------------------------

title_matches_edit <- read.csv("02_lit-review/title-matches-optim-original-order-edit-demands.csv")
lit <- title_matches_edit

## Only keep the relevant literature
lit <- filter(lit, notes.1!="CUT") ## 135 models remain

## Save number of files in reduced list (for output into document)
cut_list_size <- dim(lit)[1]
cut_list_size <- prettyNum(cut_list_size, big.mark=",") # Insert a 1,000s comma separator
```

This step returned `r uncut_list_size` results which were filtered using R code to automatically remove titles not containing words related to 'optimization', and titles unrelated to resource management[^filter-words]; before other irrelevant titles were removed manually. This left `r cut_list_size` documents, which describe optimisation models at various scales, from optimising some component in a powerplant, to planning strategies at a regional level. The results include both concrete models (usually in the form of laboratory-based experiments which find the operating conditions which resulted in optimal resource production), and abstract models.

[^filter-words]: This filtering began by removing common words (e.g. 'the') using the functionality of the text mining package `tm` in R, before identifying 11,967 unique words. Then, from this automatically generated list, words which did not refer to resources (e.g. 'network') were removed manually, leaving 366 unique words. Only titles containing words from this list remained in the review.

This review could consider many different ways to categorise models (e.g. spatial and temporal resolution, time horizon, incorporation of endogenous resource demands, integration capabilities with other models, etc.), but this review will focus on three characteristics most relevant to this thesis, namely: the **scale** for which the model optimises resources; the **level** at which models make infrastructure planning decisions; and the extent to which models integrate different resource management systems in order to take advantage of synergies (**integration**). Note that this reviews the way the system has been conceptualised, rather than the technical detail of the model (which will be discussed in Chapter \ref{sec:model-dev}). [^sys-review]. 

[^sys-review]: In reviewing modelling literature to identify challenges and opportunities, the review methodology here has similarities with those used elsewhere -- see for example the review of urban energy systems models in @Keirstead2012b.

\begin{description}

\item [Scale] There are various scales at which resource management is optimised, ranging from a component in a plant (e.g. \citet{Wu2015}) to thinking about how resources should be managed at the global level (e.g. \citet{Liu2013b}). The majority of the literature concerns how to optimally use resources within a plant such as a power plant (e.g. \citet{Prasertsan2001}), or a chemical refinery (e.g. \citet{Rizwan2015}). However, there are still a significant presence of models which consider multiple facilities, within EIPs (e.g. \citet{Taskhiri2014}) and cities (e.g. \citet{Newman2014}).

\item [Level] Some optimisation models are used in research, or the early exploratory stages of a system design, whereas other models are used to generate the precision required to design and operate a real-world system. These models tend to differ in terms of the detail to which they design a model. (Note: this is not the same as spatial or temporal scale, though it maybe more likely that models that consider smaller geographical areas and/or shorter time horizons can be more detailed.) The most detailed models make \textbf{low-level} decisions, optimising variables such as the concentration of input chemicals to lithium hydroxide production \citep{Grageda2015}, and biomass moisture content in a gasification plant \citep{Morandin2013}.

At the \textbf{high-level}, models consider a system's superstructure, representing it as a network of resource sinks and sources, and their connections between them. Often, their job is to identify optimal quantities and timings of resource transfers between these sinks and sources. They may optimise a spatial layout (the location of, and distance between sinks and sources), but they do not go into the precision of detailed design. Examples include \citet{Keirstead2012b}'s urban energy system model, the urban water system models of \citet{Lim2010} and \citet{Makropoulos2008}, whose models maximise opportunities for wastewater reuse, by identifying urban sinks and sources of waters of various different contamination levels, and optimising how they might be connected.

Between the high- and low-level models are those that make decisions at the \textbf{medium-level}. These models have as their main focus a system's superstructure, yet there are still some low-level variables considered by the model. An example is \citet{Newman2014} which not only models the relationships between sinks and sources of an urban water distribution system, but also aspects of it such as pump sizing.

\item [Integration] Thirdly, resource management optimisation models can vary in the extent to which they integrate different resource management systems. Here, we define three levels, each of which indicates to what extent a model considers intersectoral synergies is part of the optimisation (diagramatically represented in Figure \ref{fig:integn-levels}).

Some models are \textbf{non-integrated}. These models consider just one resource system, such as the urban energy systems model of \citet{Keirstead2012}, or the urban water network model of \citet{Keedwell2006}. \textbf{Integrated} models on the other hand will optimise for one resource, but while considering other systems, such as \citet{Deng2013}, which considers a chemical plant, but optimises its water network (i.e. the objective is to minimise freshwater use, with the chemical production being a constraint -- they are not both part of the objective). Finally, \textbf{highly integrated} models try to simultaneously meet the demands for more than one resource management system. These models have as their main purpose, the optimisation of synergies between different resource management systems. Examples include \citet{Moon2009} which simultaneously optimises waste water and heat exchange networks in process industries, to minimise their total combined cost.

\end{description}

\begin{figure}
	\centering
  	\begin{subfigure}{0.3\textwidth}
        \includegraphics{02_lit-review/none-integrated.pdf}
	\caption{Non-integrated modelling.}
	\label{fig:interation-none}
	\end{subfigure}

  	\begin{subfigure}{0.3\textwidth}
        \includegraphics{02_lit-review/integrated.pdf}
	\caption{Integrated modelling.}
	\label{fig:interation-medium}
	\end{subfigure}

  	\begin{subfigure}{0.3\textwidth}
        \includegraphics{02_lit-review/highly-integrated.pdf}
	\caption{Highly-integrated modelling.}
	\label{fig:interation-high}
	\end{subfigure}

	\caption{Different levels of integration when modelling systems which manage resources.}
        \label{fig:integn-levels}
\end{figure}

<!--
\begin{figure}
  \centering
  \includegraphics[width=\textwidth]{02_lit-review/integration-levels}
  \caption{Representation of low-, medium-, and high-levels of integration in resource optimisation modelling.}
  \label{fig:integn-levels}
\end{figure}
-->

The resource management optimisation models in the filtered list have been plotted as points on Figure \ref{fig:model-integration}. The point is coloured according to the modelling type, while its scale, level of integration, and level are represented by its location, and the models cited above are labelled on the plot. The plot shows that in general, smaller-scale systems are modelled are more interested in just a single resource, and their systems are modelled in greater detail. These models are also more likely to be experimental. Larger systems are more likely to consider multiple resources in a integrated or highly integrated fashion, and none of these models go into design detail (all are either medium- or high-level). For these models, mathematical optimisation is the most commonly used method.

```{r model-lit-review-categMatchPlot, fig.height=7, fig.cap="An overview of the resource management optimisation literature, with each point representing a reference. Jitter has been applied to the points to prevent them overlapping one another.\\label{fig:model-integration}"}


###--------------------------------------------------
### Plot overview of literature
###--------------------------------------------------


unique_levels <- unique(lit$level)
unique_cats <- unique(lit$cat_matches_list)
unique_optimised.systems <- unique(lit$optimised.system.s.)

## Provide a more user-friendly name for levels on the facet strips
lit$level <- as.character(lit$level)
lit[lit$level=="high", "level"] <- "high level"
lit[lit$level=="medium", "level"] <- "medium level"
lit[lit$level=="low", "level"] <- "low level"

## Remove the misc. model (just for clarity)
lit <- filter(lit, methods!="misc.")

## Sort so levels are plotted in ascending order
lit <- transform(lit,
		 scale=factor(scale,
		   levels=c("component",
			    "domestic", 
			    "plant",
			    "plant (multiple components)",
			    "plant (couple)",
			    "refinery/chem. plant",
			    "EIP",
			    "city",
			    "region",
			    "agricultural area",
			    "global",
			    "various"),
		    ordered=TRUE),
		 methods=factor(methods,
		   levels=c("concrete",
			    "concrete statistical", 
			    "simulation",
			    "optimisation",
			    "misc."),
		    ordered=TRUE),
		 integration=factor(integration,
		    levels=c("none",
			    "integrated",
			    "highly integrated"),
		    ordered=TRUE),
		 level=factor(level,
	            levels=c("high level",
			     "medium level",
			     "low level"),
		    ordered=TRUE),
		 cat_matches_list=factor(cat_matches_list,
		   levels=c("various, waste",
			   "various, water",
			   "waste, water",
			   "energy, various",
			   "energy, waste",
			   "energy, water",
			   "energy, various, waste",
			   "energy, various, water",
			   "energy, waste, water",
			   "energy, water, waste",
			   "various, waste, water",
			   "energy, various, waste, water"),
		    ordered=TRUE))

## Add column to colour the points within the site and the city regions
lit$colour <- "noColour"
lit[lit$Scale=="region", "colour"]  <- "colour"
lit[lit$Scale=="city", "colour"]  <- "colour"
lit[lit$Scale=="EIP", "colour"]  <- "colour"
lit[lit$Scale=="refinery/chem. plant", "colour"]  <- "colour"

## Plot as dot plot: integration vs. scale
plot_lit_int.scale <- ggplot(lit, aes(scale, integration)) +
#  geom_jitter(aes(colour=optimised.system.s.)) +
#  geom_jitter(aes(colour=opt.systems.summary)) +
#  geom_jitter(aes(colour=level)) +
  geom_jitter(aes(colour=methods)) +
  geom_text(data = lit, aes(scale, integration, label=citation, colour=methods), size=2) +
  facet_wrap(~level, ncol=1) +
  xlab("Scale") +
  ylab("System integration") +
  theme_bw() +
  theme(axis.text.x = element_text(hjust=1, angle=30),
	legend.position = "bottom",
	legend.direction = "vertical") +
  guides(col=guide_legend(nrow=2))
plot_lit_int.scale

### Plot as dot plot: focus vs. methods
#plot_lit_focus.methods <- ggplot(lit, aes(optimised.system.s., methods)) +
#  geom_jitter(aes(colour=opt.systems.summary)) +
#  xlab("Optimised systems") +
#  ylab("Methods") +
#  theme_bw() +
#  theme(axis.text.x = element_text(hjust=1, angle=30),
#	legend.position = "bottom",
#	legend.direction = "vertical") +
#  guides(col=guide_legend(ncol=2))
#plot_lit_focus.methods

```

Highly integrated models (the focus of this thesis) are still the least common type, and especially so at the city scale where models tend to only consider one resource sector in isolation (e.g. an urban energy system), or the integration of energy or water systems into other systems. (The two highly integrated models captured by the search both consider how water and wastewater systems can work together to minimise freshwater consumption.) This lack of urban-scale highly-integrated models means there is little to help the decision maker to take advantage of the infrastructure co-location to realise intersectoral synergies. Thus current optimisation models use to help plan urban resource management systems impose a ceiling on potential material and energy savings, by not considering energy, water and waste systems in combination.

This thesis will begin to meet this gap by formulating a city-scale, highly integrated optimisation model. An additional insight this literature overview gives is that that the model should be high-level. This is intuitive when considering multiple resource system types: it is prudent to start with a simple representation of the various systems, before delving into the intricacies of the detail design and operation of the systems, which require specialist expertise regarding the systems being modelled.
<!--
The highly integrated models closest to the ambitions of this thesis are formulated for eco-industrial parks (EIPs). These models try to realise maximum benefit from IE possibilities, and thereby identify the most beneficial energy and material exchanges between processes [TODO: cite an example?].
-->
<!--
 However, as the review article by @Boix2015 notes, these models emphasize "...either the water network, or the energy links or waste disposal facilities but never the whole networking" (p.314). 
-->


## Conclusion

This chapter has given overviews of two research fields which motivate and inform the development of optimisation models to improve an area's metabolism. With regards to UM, the metaphorical framework is not currently sufficient to account for a city's overall metabolic flows in relation to the mix of resource management processes used within a city. The review also showed that while modelling is often used to aid understanding of urban metabolism, there is room to contribute a model which considers how multiple resources and various resource management processes can be optimally mixed. The review of resource optimisation modelling found no models which integrated the design of energy, water and waste management systems at the urban scale. Nevertheless, there were models which integrated the planning of more than one system at other scales, thus providing precedent for the type of modelling work, which this thesis will apply to a new area.

In order to answer the research question, this rest of this thesis brings together the two fields reviewed in this chapter. Introducing the proposed network representation of a city into the conceptual model of an area's UM, opens up the possibility of formulating a model which can consider interactions and synergies between the energy, water and waste sectors to help plan urban resource management in more sustainable ways. Getting to the point of applying such a model must come after a number of intermediate steps. First, the conceptual model of Figure \ref{fig:metab} needs to be represented mathematically (Chapter 5). Second, the model will require data to define parameters, such as the resource consumption of processes (Chapter 4). Thirdly, it is not obvious how to measure the performance of a highly-integrated systems, because each system will have its own associated metrics (such as freshwater consumption for water management systems, or greenhouse gas emissions for an urban energy system) -- the next chapter attempts to find suitable metrics for highly integrated urban resource management systems.

<!--

TODO: Consider moving content from here into the literature review

This review first argues that the UM field should advance [TODO: foster, nuture, develop?] a more sophisticated understanding of how the resource management processes in a city affects its overall metabolism. Second, the review shows that urban resource optimisation modelling tends to only consider one resource sector in isolation (e.g. an urban energy system), and thus we argue for optimisation models which consider the simultaneous design of energy, water, and waste systems, i.e. 'integrated'. Nevertheless, there are sufficient precedent models to suggest that such a model can be both formulated, and applied. The rest of this thesis goes on to meet the first challenge by proposing that a city's management of goods and services can be modelled as an 'engineered system' (i.e., a network of processes which convert and transport resources). Notably, this understanding incorporates energy, water and waste management systems, and thus this thesis is placed to address the second challenge, by representing this engineered system using a set of equations which can form the basis of an optimisation model. In this way, this chapter lays the foundation to justify and contribute an optimisation tool which can help improve a city's metabolism.
-->

<!--
As the UM framework is used to study urban sustainability, in relation to its resource flows, forms, and function, one developing area is consider the processes occurring inside a city more closely.
-->

<!--
In summary, optimisation modelling is used for many purposes to help plan resource management. However, our exhaustive search of the literature how shown that no models are appropriate to consider urban energy, water and waste management simultaneously, to realise synergistic benefits. Nevertheless, they do model multiple resource optimisation at suitable scales, to make the idea of such a model plausible (at least from an engineering point of view, if not one of free-market economics.

Lit review structure from JK's MILP paper.

- General decisions (discrete, continuous), linear, nonlienar, algorithms etc.
- Existing models (continue paragraph on small scale)
- Existing models (moving up the scale)
- Existing models (highest level)
- Example of a generic model
- Another example of a generic model
- Another example of a generic model
- Another example of a generic model
- Specific examples
- Summary of existing models
- Models with the most potential
- "The model presented in this paper has been developed to..." continue to understand the inside of the blackbox
-->
